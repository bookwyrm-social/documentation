<!DOCTYPE html>
<html lang="ro">
<head>
    <title>
        
Using a Reverse-Proxy

    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="/static/css/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bulma.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bookwyrm.css">

    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bookwyrm Documentation">
    <meta name="og:title" content="Bookwyrm Documentation">
    <meta name="twitter:description" content="Documentation for using and contributing to BookWyrm">
    <meta name="og:description" content="Documentation for using and contributing to BookWyrm">

    <meta name="twitter:image" content="">
    <meta name="og:image" content="">
    <meta name="twitter:image:alt" content="BookWyrm Logo">

    <meta charset="UTF-8">
</head>
<body>
<nav class="navbar container is-max-desktop" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://joinbookwyrm.com/">
            <img class="image logo" src="/static/images/logo-small.png" alt="Go back to the homepage">
        </a>
    </div>

    <div class="navbar-menu" id="main-nav">
        <div class="navbar-start">
            <a href="https://joinbookwyrm.com/ro/instances" class="navbar-item">
                <span class="button is-success has-text-weight-normal has-text-white">Alăturați-vă</span>
            </a>
            <a href="https://joinbookwyrm.com/ro/get-involved" class="navbar-item">
                Implicați-vă
            </a>
            <a href="https://www.patreon.com/bookwyrm" class="navbar-item">
                Susțineți
            </a>
            <a href="https://github.com/bookwyrm-social/bookwyrm" class="navbar-item">
                Cod
            </a>
            <a href="#" class="navbar-item is-active">
                Documentație
            </a>
        </div>
    </div>
    <div class="navbar-end">
        <div class="navbar-item">
            <div class="select">
                <select aria-label="Select a language" id="language_selection">
                    
                    <option value="" >English (US)</option>
                    
                    <option value="de/" >Deutsch</option>
                    
                    <option value="fr/" >Français</option>
                    
                    <option value="pl/" >Polski</option>
                    
                    <option value="pt-br/" >Português do Brasil</option>
                    
                    <option value="ro/" selected>Română</option>
                    
              </select>
            </div>
        </div>
    </div>
</nav>

<div class="container is-max-desktop">
<section class="section">

    <header class="content block column is-offset-one-quarter pl-2">
        
<h1 class="title is-1">Using a Reverse-Proxy</h1>

    </header>
    <div class="columns">
	<nav class="menu column is-one-quarter mt-2">
            <h2 class="menu-label"><a href="/ro/">Welcome</a></h2>
            
            <h2 class="menu-label">Using BookWyrm</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/ro/posting-statuses.html" >Posting statuses</a>
                </li>
                
                <li>
                    <a href="/ro/adding-books.html" >Adding Books</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Running BookWyrm</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/ro/install-prod.html" >Installing in Production</a>
                </li>
                
                <li>
                    <a href="/ro/install-prod-dockerless.html" >Installing Without Docker</a>
                </li>
                
                <li>
                    <a href="/ro/updating.html" >Updating Your Instance</a>
                </li>
                
                <li>
                    <a href="/ro/reverse-proxy.html" class="is-active">Using a Reverse-Proxy</a>
                </li>
                
                <li>
                    <a href="/ro/moderation.html" >Moderation</a>
                </li>
                
                <li>
                    <a href="/ro/monitoring-queue.html" >Monitoring Queue</a>
                </li>
                
                <li>
                    <a href="/ro/external-storage.html" >External Storage</a>
                </li>
                
                <li>
                    <a href="/ro/optional_features.html" >Optional features</a>
                </li>
                
                <li>
                    <a href="/ro/cli.html" >Command Line Tool</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Contributing</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/ro/contributing.html" >How to Contribute</a>
                </li>
                
                <li>
                    <a href="/ro/translation.html" >Translations</a>
                </li>
                
                <li>
                    <a href="/ro/install-dev.html" >Developer Environment</a>
                </li>
                
                <li>
                    <a href="/ro/style_guide.html" >Style Guide</a>
                </li>
                
                <li>
                    <a href="/ro/debug_toolbar.html" >Django Debug Toolbar</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Codebase</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/ro/permissions.html" ></a>
                </li>
                
                <li>
                    <a href="/ro/activitypub.html" >ActivitatePub</a>
                </li>
                
            </ul>
            
        </nav>

        <div class="column">
            
<section class="block content">
    <h2>Rularea BookWyrm în spatele unui Reverse-Proxy</h2>
<p>Dacă rulați un alt server web pe mașina dvs., trebuie să-l configurați să transmită cererile web către BookWyrm.</p>
<p>Configurația BookWyrm de bază are deja un server nginx care redirecționează cererile către aplicația Django care se ocupă de SSL și deservește în mod direct fișierele statice. Fișierele statice sunt stocate într-un volum Docker la care au acces mai multe servicii BookWrym, deci nu este recomandat să înlăturați complet acest server.</p>
<p>Pentru a rula BookWyrm în spatele unui reverse-proxy, faceți următoarele schimbări:</p>
<ul>
<li>În <code>nginx/default.conf</code>:<ul>
<li>Comentați cele două servere implicite</li>
<li>Decomentați server-ul etichetat „Reverse-Proxy server”</li>
<li>Înlocuiți <code>your-domain.com</code> cu numele domeniului dvs.</li>
</ul>
</li>
<li>În <code>docker-compose.yml</code>:<ul>
<li>În <code>services</code> -&gt; <code>nginx</code> -&gt; <code>ports</code>, comentați porturile implicite și adăugați <code>- 8001:8001</code></li>
<li>În <code>services</code> -&gt; <code>nginx</code> -&gt; <code>volumes</code>, comentați cele două volume care încep <code>./certbot/</code></li>
<li>În <code>services</code>, comentați serviciul <code>certbot</code></li>
</ul>
</li>
</ul>
<p>În acest moment, puteți urmări instrucțiunile <a href="#server-setup">setup</a> listate. Odată ce Docker rulează, puteți accesa instanța dvs. de BookWyrm la <code>http://localhost:8001</code> (<strong>NOTĂ:</strong> serverul dvs. nu este accesibil prin <code>https</code>).</p>
<p>Pașii pentru configurarea unui reverse-proxy sunt independenți de server.</p>
<h4>Nginx</h4>
<p>Înainte de a putea configura nginx, veți avea nevoie să localizați dosarul dvs. de configurare nginx, care este dependent de platforma dvs. și de cum ați instalat nginx. Vedeți <a href="http://nginx.org/en/docs/beginners_guide.html">ghidul nginx</a> pentru detalii.</p>
<p>Pentru a configura serverul dvs.:</p>
<ul>
<li>În fișierul dvs. <code>nginx.conf</code>, asigurați-vă că <code>include servers/*;</code> nu este comentat.</li>
<li>În dosarul dvs. nginx <code>servers</code>, creați un nou fișier numit după domeniul dvs. conținând următoarele informații:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">your-domain.com</span><span class="w"> </span><span class="s">www.your-domain.com</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:8000</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/images/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:8001</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/static/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:8001</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="s">[::]:80</span><span class="w"> </span><span class="s">ssl</span><span class="p">;</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="s">ssl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Pentru a configura un bloc SSL:</p>
<div class="highlight"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">your.domain</span><span class="p">;</span>

<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="s">[::]:80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Strict-Transport-Security</span><span class="w"> </span><span class="s">&quot;max-age=31536000</span><span class="p">;</span><span class="kn">includeSubDomains&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>
<span class="w">    </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^</span><span class="w"> </span><span class="s">https://</span><span class="nv">$server_name$request_uri</span><span class="p">;</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">return</span><span class="w"> </span><span class="mi">301</span><span class="w"> </span><span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># SSL code</span>
<span class="k">ssl_certificate</span><span class="w"> </span><span class="s">/etc/letsencrypt/live/your.domain/fullchain.pem</span><span class="p">;</span>
<span class="k">ssl_certificate_key</span><span class="w"> </span><span class="s">/etc/letsencrypt/live/your.domain/privkey.pem</span><span class="p">;</span>

<span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="s">[::]:443</span><span class="w"> </span><span class="s">ssl</span><span class="w"> </span><span class="s">http2</span><span class="p">;</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="s">ssl</span><span class="w"> </span><span class="s">http2</span><span class="p">;</span>

<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">your.domain</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Strict-Transport-Security</span><span class="w"> </span><span class="s">&quot;max-age=31536000</span><span class="p">;</span><span class="w"> </span><span class="kn">includeSubDomains&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:8000</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/images/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:8001</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/static/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:8001</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>rulați <code>sudo certbot run --nginx --email YOUR_EMAIL -d your-domain.com -d www.your-domain.com</code></li>
<li>reporniți nginx</li>
</ul>
<p>Dacă totul a funcționat corect, instanța dvs. BookWyrm ar trebui să fie acum accesibilă din exterior.</p>
<p><em>Notă: <code>proxy_set_header Host $host;</code> este esențial; dacă nu-l includeți, mesajele primite de la serverele federate vor fi respinse.</em></p>
<p><em>Notă: locația certificatelor SSL poate varia în funcție de SO (sistemul de operare) al serverului dvs.</em></p>
</section>

        </div>
    </div>
</section>
</div>

<footer id="contentinfo" class="footer">
    <div class="container is-max-desktop">
        <div class="columns">
            <div class="column content">
                <p>
                    <strong>BookWyrm</strong> este un program colaborativ, anti-corporație, menținut de <a href='https://www.mousereeve.com/'>Mouse Reeve</a>.
                </p>
                <p>
                    Susțineți BookWyrm pe <a href='https://www.patreon.com/bookwyrm' target='_blank'>Patreon</a>.
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Alăturați-vă</h3>
                <p>
                    <a href="https://github.com/bookwyrm-social">BookWyrm pe GitHub</a>
                </p>
                <p>
                    <a href="https://github.com/bookwyrm-social/documentation/blob/main/content/running_bookwyrm/reverse-proxy.md">Contribuiți la această pagină</a>
                </p>
                <p>
                    <a href="https://twitter.com/BookWyrmSocial" target="_blank">
                        <span class="icon icon-twitter"><span class="is-sr-only">Twitter</span></span>
                    </a>
                    <a href="https://tech.lgbt/@bookwyrm" target="_blank" rel="me">
                        <span class="icon icon-mastodon"><span class="is-sr-only">Mastodon</span></span>
                    </a>
                    <a href="https://www.patreon.com/bookwyrm" target="_blank">
                        <span class="icon icon-patreon"><span class="is-sr-only">Patreon</span></span>
                    </a>
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Aflați mai multe</h3>
                <p>
                    <a href="https://docs.joinbookwyrm.com">Documentație</a>
                </p>
                <p>
                    <a href="mailto:mousereeve@riseup.net">Contactați responsabilul</a>
                </p>
                <p>
                    <a href="https://raw.githubusercontent.com/bookwyrm-social/join-bookwyrm/main/LICENSE.md">Licență</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
    (function() {
        var languageSelector = document.getElementById("language_selection");
        languageSelector.onchange = function(event) {
            var current_locale = "ro/";
            var current_location = window.location.pathname;

            var locale_index = current_location.indexOf(current_locale);
            var new_location = "/" + event.target.value;

            if (locale_index) {
                new_location += current_location.slice(locale_index + current_locale.length);
            } else {
                new_location += current_location.slice(1);
            }

            window.location = new_location;
        }
    })()
</script>

</body>
</html>