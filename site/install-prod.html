<!DOCTYPE html>
<html lang="en">
<head>
    <title>
        
Installing in Production

    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="/static/css/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bulma.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bookwyrm.css?v076">

    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bookwyrm Documentation">
    <meta name="og:title" content="Bookwyrm Documentation">
    <meta name="twitter:description" content="Documentation for using and contributing to BookWyrm">
    <meta name="og:description" content="Documentation for using and contributing to BookWyrm">

    <meta name="twitter:image" content="">
    <meta name="og:image" content="">
    <meta name="twitter:image:alt" content="BookWyrm Logo">

    <meta charset="UTF-8">
</head>
<body>
<nav class="navbar container is-max-desktop" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://joinbookwyrm.com/">
            <img class="image logo" src="/static/images/logo-small.png" alt="Go back to the homepage">
        </a>
        <a href="/" class="navbar-item has-text-link has-text-weight-bold">
            Documentation
        </a>
        <a role="button" class="navbar-burger" data-target="main-nav" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>

    <div class="navbar-menu" id="main-nav">
        <div class="navbar-start">
            <a href="https://joinbookwyrm.com/instances" class="navbar-item">
                Join
            </a>
            <a href="https://joinbookwyrm.com/get-involved" class="navbar-item">
                Get involved
            </a>
            <a href="https://www.patreon.com/bookwyrm" class="navbar-item">
                Support
            </a>
            <a href="https://github.com/bookwyrm-social/bookwyrm" class="navbar-item">
                Code
            </a>
        </div>
    </div>
</nav>

<div class="message is-danger">
    <div class="message-body has-text-centered">
        This is the documentation for the current development code. Choose a version from the menu to see documentation for released versions since <strong>v0.7.5</strong>.
    </div>
</div>


<div class="columns">
    <nav class="menu column is-one-quarter is-hidden-touch pl-6" id="menu">
        <h2 class="menu-label">Language & Version</a></h2>
        <div class="select">
            <select aria-label="Select a language" id="language_selection">
                
                <option value="" selected>English (US)</option>
                
                <option value="de/" >Deutsch</option>
                
                <option value="fr/" >Français</option>
                
                <option value="pl/" >Polski</option>
                
                <option value="pt-br/" >Português do Brasil</option>
                
                <option value="ro/" >Română</option>
                
          </select>
        </div>
        <div class="select">
            <select aria-label="Previous versions" id="version_selection">
                
                <option value="development" >development</option>
                
                <option value="v0.7.5" >v0.7.5</option>
                
            </select>
        </div>
        
        <h2 class="menu-label">Using BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/main-menu.html" class="has-background-inherit" >Main Menu & Timelines</a>
            </li>
            
            <li>
                <a href="/shelves.html" class="has-background-inherit" >Shelves & Reading Status</a>
            </li>
            
            <li>
                <a href="/adding-books.html" class="has-background-inherit" >Adding Books</a>
            </li>
            
            <li>
                <a href="/posting-statuses.html" class="has-background-inherit" >Posting Statuses</a>
            </li>
            
            <li>
                <a href="/lists.html" class="has-background-inherit" >Lists</a>
            </li>
            
            <li>
                <a href="/privacy-controls.html" class="has-background-inherit" >Privacy Controls</a>
            </li>
            
            <li>
                <a href="/groups.html" class="has-background-inherit" >Groups</a>
            </li>
            
            <li>
                <a href="/rss-feeds.html" class="has-background-inherit" >RSS Feeds</a>
            </li>
            
            <li>
                <a href="/user-migration.html" class="has-background-inherit" >User Migration and Aliases</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Running BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/install-prod.html" class="has-background-inherit" class="is-active">Installing in Production</a>
            </li>
            
            <li>
                <a href="/install-prod-dockerless.html" class="has-background-inherit" >Installing Without Docker</a>
            </li>
            
            <li>
                <a href="/updating.html" class="has-background-inherit" >Updating Your Instance</a>
            </li>
            
            <li>
                <a href="/updating-dockerless.html" class="has-background-inherit" >Updating Without Docker</a>
            </li>
            
            <li>
                <a href="/reverse-proxy.html" class="has-background-inherit" >Using a Reverse-Proxy</a>
            </li>
            
            <li>
                <a href="/moderation.html" class="has-background-inherit" >Moderation</a>
            </li>
            
            <li>
                <a href="/monitoring-queue.html" class="has-background-inherit" >Monitoring Queue</a>
            </li>
            
            <li>
                <a href="/external-storage.html" class="has-background-inherit" >External Storage</a>
            </li>
            
            <li>
                <a href="/optional_features.html" class="has-background-inherit" >Optional Features</a>
            </li>
            
            <li>
                <a href="/management-commands.html" class="has-background-inherit" >Management Commands</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Contributing</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/contributing.html" class="has-background-inherit" >How to Contribute</a>
            </li>
            
            <li>
                <a href="/translation.html" class="has-background-inherit" >Translations</a>
            </li>
            
            <li>
                <a href="/style_guide.html" class="has-background-inherit" >Style Guide</a>
            </li>
            
            <li>
                <a href="/documentation.html" class="has-background-inherit" >Documentation</a>
            </li>
            
            <li>
                <a href="/install-dev.html" class="has-background-inherit" >Developer Environment</a>
            </li>
            
            <li>
                <a href="/debug_toolbar.html" class="has-background-inherit" >Django Debug Toolbar</a>
            </li>
            
            <li>
                <a href="/codereview.html" class="has-background-inherit" >Code Review</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Codebase</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/activitypub.html" class="has-background-inherit" >ActivityPub</a>
            </li>
            
            <li>
                <a href="/permissions.html" class="has-background-inherit" >Permissions</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Reference Guides</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/environment.html" class="has-background-inherit" >Environment Variables</a>
            </li>
            
            <li>
                <a href="/cli.html" class="has-background-inherit" >Command Line Tool</a>
            </li>
            
        </ul>
        
    </nav>

    <div class="column pt-0">
        

<nav class="navbar is-dark" role="table-of-contents-navigation" aria-label="dropdown navigation">
    <div class="navbar-start">
        <div class="navbar-item has-dropdown" id="toc" data-target="toc-dropdown">
            <a class="navbar-link">
              Page Contents
            </a>

            <div class="navbar-dropdown is-hidden-touch " id="toc-dropdown">
              
                  <a class="navbar-item" href="#server-setup">Server setup</a>
                  
              
                  <a class="navbar-item" href="#install-and-configure-bookwyrm">Install and configure BookWyrm</a>
                  
              
                  <a class="navbar-item" href="#backups">Backups</a>
                  
              
                  <a class="navbar-item" href="#port-conflicts">Port Conflicts</a>
                  
              
                  <a class="navbar-item" href="#get-connected">Get Connected</a>
                  
              
            </div>
          </div>
    </div>
  </nav>


        <div class="container is-max-desktop">
            <section class="section">
                <header class="content block column is-offset-one-quarter pl-2">
                    
<h1 class="title is-1">Installing in Production</h1>

                </header>
                
<section class="block content">
    <p>This project is still young and isn't, at the moment, very stable, so please proceed with caution when running in production.</p>
<h2 id="server-setup"><a class="headerlink" href="#server-setup">Server setup</a></h2>
<ul>
<li>Get a domain name and set up DNS for your server. You'll need to point the nameservers of your domain on your DNS provider to the server where you'll be hosting BookWyrm. Here are instructions for <a href="https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars">DigitalOcean</a></li>
<li>Set your server up with appropriate firewalls for running a web application (this instruction set is tested against Ubuntu 20.04). Here are instructions for <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04">DigitalOcean</a></li>
<li>Set up an email service (such as <a href="https://documentation.mailgun.com/en/latest/quickstart.html">Mailgun</a>) and the appropriate SMTP/DNS settings. Use the service's documentation for configuring your DNS</li>
<li><a href="https://docs.docker.com/compose/install/">Install Docker and docker-compose</a></li>
</ul>
<h2 id="install-and-configure-bookwyrm"><a class="headerlink" href="#install-and-configure-bookwyrm">Install and configure BookWyrm</a></h2>
<p>There are several repos in the BookWyrm org, including documentation, a static landing page, and the actual Bookwyrm code. To run BookWyrm, you want the actual app code which is in <a href="https://github.com/bookwyrm-social/bookwyrm">bookwyrm-social/bookwyrm</a>.</p>
<p>The <code>production</code> branch of BookWyrm contains a number of tools not on the <code>main</code> branch that are suited for running in production, such as <code>docker-compose</code> changes to update the default commands or configuration of containers, and individual changes to container config to enable things like SSL or regular backups.</p>
<p>Instructions for running BookWyrm in production:</p>
<ul>
<li>Get the application code:
    <code>git clone git@github.com:bookwyrm-social/bookwyrm.git</code></li>
<li>Switch to the <code>production</code> branch:
    <code>git checkout production</code></li>
<li>Create your environment variables file, <code>cp .env.example .env</code>, and update the following:<ul>
<li><code>DOMAIN</code> | Your web domain</li>
<li><code>EMAIL</code> | Email address to be used for certbot domain verification</li>
<li><code>FLOWER_USER</code> | Your own username for accessing Flower queue monitor</li>
<li><code>EMAIL_HOST_USER</code> | The "from" address that your app will use when sending email</li>
<li><code>EMAIL_HOST_PASSWORD</code> | The password provided by your email service</li>
</ul>
</li>
<li>Initialize secrets by running <code>./bw-dev create_secrets</code> or manually update following in <code>.env</code>:<ul>
<li><code>SECRET_KEY</code> | A difficult to guess, secret string of characters</li>
<li><code>POSTGRES_PASSWORD</code> | Set a secure password for the database</li>
<li><code>REDIS_ACTIVITY_PASSWORD</code> | Set a secure password for Redis Activity subsystem</li>
<li><code>REDIS_BROKER_PASSWORD</code> | Set a secure password for Redis queue broker subsystem</li>
<li><code>FLOWER_PASSWORD</code> | Your own secure password for accessing Flower queue monitor</li>
<li>If you are running another web-server on your host machine, you will need to follow the <a href="/reverse-proxy.html">reverse-proxy instructions</a></li>
</ul>
</li>
<li>Check that you have <a href="/environment.html#required-environment-settings">all the required settings configured</a> before proceeding further</li>
<li>Setup ssl certificate via letsencrypt by running <code>./bw-dev init_ssl</code></li>
<li>Initialize the database by running <code>./bw-dev migrate</code></li>
<li>Run the application with
  <code>docker-compose up --build</code>, and make sure all the images build successfully<ul>
<li>If you are running other services on your host machine, you may run into errors where services fail when attempting to bind to a port.
See the <a href="#port_conflicts">troubleshooting guide</a> for advice on resolving this.</li>
</ul>
</li>
<li>When docker has built successfully, stop the process with <code>CTRL-C</code></li>
<li>If you wish to use an external storage for static assets and media files (such as an S3-compatible service), <a href="/external-storage.html">follow the instructions</a> until it tells you to come back here</li>
<li>Initialize the application with <code>./bw-dev setup</code>, and copy the admin code to use when you create your admin account.<ul>
<li>The output of <code>./bw-dev setup</code> should conclude with your admin code. You can get your code at any time by running <code>./bw-dev admin_code</code> from the command line. Here's an example output:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>*******************************************
Use<span class="w"> </span>this<span class="w"> </span>code<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>your<span class="w"> </span>admin<span class="w"> </span>account:
c6c35779-af3a-4091-b330-c026610920d6
*******************************************
</code></pre></div>

<ul>
<li>Run docker-compose in the background with: <code>docker-compose up -d</code></li>
<li>The application should be running at your domain. When you load the domain, you should get a configuration page which confirms your instance settings, and a form to create an admin account. Use your admin code to register.</li>
</ul>
<p>Congrats! You did it!! Configure your instance however you'd like.</p>
<h2 id="backups"><a class="headerlink" href="#backups">Backups</a></h2>
<p>BookWyrm's db service dumps a backup copy of its database to its <code>/backups</code> directory daily at midnight UTC.
Backups are named <code>backup__%Y-%m-%d.sql</code>.</p>
<p>The db service has an optional script for periodically pruning the backups directory so that all recent daily backups are kept, but for older backups, only weekly or monthly backups are kept.
To enable this script:</p>
<ul>
<li>Uncomment the final line in <code>postgres-docker/cronfile</code></li>
<li>rebuild your instance <code>docker-compose up --build</code></li>
</ul>
<p>You can copy backups from the backups volume to your host machine with <code>docker cp</code>:</p>
<ul>
<li>Run <code>docker-compose ps</code> to confirm the db service's full name (it's probably <code>bookwyrm_db_1</code>.</li>
<li>Run <code>docker cp &lt;container_name&gt;:/backups &lt;host machine path&gt;</code></li>
</ul>
<h2 id="port-conflicts"><a class="headerlink" href="#port-conflicts">Port Conflicts</a></h2>
<p>BookWyrm has multiple services that run on their default ports.
This means that, depending on what else you are running on your host machine, you may run into errors when building or running BookWyrm when attempts to bind to those ports fail.</p>
<p>If this occurs, you will need to change your configuration to run services on different ports.
This may require one or more changes the following files:</p>
<ul>
<li><code>docker-compose.yml</code></li>
<li><code>nginx/production.conf</code> or <code>nginx/reverse_proxy.conf</code> depending on NGINX_SETUP in .env-file</li>
<li><code>.env</code> (You create this file yourself during setup)</li>
</ul>
<p>If you are already running a web-server on your machine, you will need to set up a reverse-proxy.</p>
<h2 id="get-connected"><a class="headerlink" href="#get-connected">Get Connected</a></h2>
<p>Because BookWyrm is a young project, we're still working towards a stable release schedule, and there are a lot of bugs and breaking changes. There is a GitHub team which can be tagged when there's something important to know about an update, which you can join by sharing your GitHub username. There are a few ways in get in touch:</p>
<ul>
<li>Open an issue or pull request to add your instance to the <a href="https://joinbookwyrm.com/instances/">official list</a></li>
<li>Reach out to the project on <a href="https://tech.lgbt/@bookwyrm">Mastodon</a> or <a href="mailto:mousereeve@riseup.net">email the maintainer</a> directly with your GitHub username</li>
<li>Join the <a href="https://matrix.to/#/#bookwyrm:matrix.org">Matrix</a> chat room</li>
</ul>
</section>

            </section>
        </div>
    </div>
</div>

<footer id="contentinfo" class="footer">
    <div class="container is-max-desktop">
        <div class="columns">
            <div class="column content">
                <p>
                    <strong>BookWyrm</strong> is collaborative, anti-corporate software maintained by <a href='https://www.mousereeve.com/'>Mouse Reeve</a>.
                </p>
                <p>
                    Support BookWyrm on <a href='https://www.patreon.com/bookwyrm' target='_blank'>Patreon</a>.
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Get Involved</h3>
                <p>
                    <a href="https://github.com/bookwyrm-social">BookWyrm on GitHub</a>
                </p>
                <p>
                    <a href="https://github.com/bookwyrm-social/documentation/blob/main/content/running_bookwyrm/install-prod.md">Contribute to this page</a>
                </p>
                <p>
                    <a href="https://twitter.com/BookWyrmSocial" target="_blank">
                        <span class="icon icon-twitter"><span class="is-sr-only">Twitter</span></span>
                    </a>
                    <a href="https://tech.lgbt/@bookwyrm" target="_blank" rel="me">
                        <span class="icon icon-mastodon"><span class="is-sr-only">Mastodon</span></span>
                    </a>
                    <a href="https://www.patreon.com/bookwyrm" target="_blank">
                        <span class="icon icon-patreon"><span class="is-sr-only">Patreon</span></span>
                    </a>
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Learn more</h3>
                <p>
                    <a href="https://docs.joinbookwyrm.com">Documentation</a>
                </p>
                <p>
                    <a href="mailto:mousereeve@riseup.net">Contact maintainer</a>
                </p>
                <p>
                    <a href="https://raw.githubusercontent.com/bookwyrm-social/join-bookwyrm/main/LICENSE.md">License</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<script>
    var current_locale = "";
    var current_version = "";
</script>
<script src="/static/js/bookwyrm.js"></script>
</body>
</html>