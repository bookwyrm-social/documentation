<!DOCTYPE html>
<html lang="de">
<head>
    <title>
        
ActivityPub

    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="/static/css/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bulma.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bookwyrm.css?v076">

    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bookwyrm Documentation">
    <meta name="og:title" content="Bookwyrm Documentation">
    <meta name="twitter:description" content="Documentation for using and contributing to BookWyrm">
    <meta name="og:description" content="Documentation for using and contributing to BookWyrm">

    <meta name="twitter:image" content="">
    <meta name="og:image" content="">
    <meta name="twitter:image:alt" content="BookWyrm Logo">

    <meta charset="UTF-8">
</head>
<body>
<nav class="navbar container is-max-desktop" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://joinbookwyrm.com/">
            <img class="image logo" src="/static/images/logo-small.png" alt="Go back to the homepage">
        </a>
        <a href="/" class="navbar-item has-text-link has-text-weight-bold">
            Dokumentation
        </a>
        <a role="button" class="navbar-burger" data-target="main-nav" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>

    <div class="navbar-menu" id="main-nav">
        <div class="navbar-start">
            <a href="https://joinbookwyrm.com/de/instances" class="navbar-item">
                Beitreten
            </a>
            <a href="https://joinbookwyrm.com/de/get-involved" class="navbar-item">
                Mitmachen
            </a>
            <a href="https://www.patreon.com/bookwyrm" class="navbar-item">
                Unterstützung
            </a>
            <a href="https://github.com/bookwyrm-social/bookwyrm" class="navbar-item">
                Code
            </a>
        </div>
    </div>
</nav>


<div class="columns">
    <nav class="menu column is-one-quarter is-hidden-touch pl-6 mt-4" id="menu">
        <h2 class="menu-label">Language & Version</a></h2>
        <div class="select">
            <select aria-label="Select a language" id="language_selection">
                
                <option value="" >English (US)</option>
                
                <option value="de/" selected>Deutsch</option>
                
                <option value="fr/" >Français</option>
                
                <option value="pl/" >Polski</option>
                
                <option value="pt-br/" >Português do Brasil</option>
                
                <option value="ro/" >Română</option>
                
          </select>
        </div>
        <div class="select">
            <select aria-label="Previous versions" id="version_selection">
                
                <option value="development" >development</option>
                
                <option value="v0.7.5" selected>v0.7.5</option>
                
            </select>
        </div>
        
        <h2 class="menu-label">Using BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/v0.7.5/de/main-menu.html" class="has-background-inherit" >Main Menu & Timelines</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/shelves.html" class="has-background-inherit" >Shelves & Reading Status</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/adding-books.html" class="has-background-inherit" >Bücher hinzufügen</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/settings.html" class="has-background-inherit" >Settings and Profile</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/posting-statuses.html" class="has-background-inherit" >Posting Statuses</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/lists.html" class="has-background-inherit" >Lists</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/privacy-controls.html" class="has-background-inherit" >Privacy Controls</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/groups.html" class="has-background-inherit" >Groups</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/rss-feeds.html" class="has-background-inherit" >RSS Feeds</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/user-migration.html" class="has-background-inherit" >User Migration and Aliases</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Running BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/v0.7.5/de/install-prod.html" class="has-background-inherit" >Installing in Production</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/install-prod-dockerless.html" class="has-background-inherit" >Installation ohne Docker</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/updating.html" class="has-background-inherit" >Deine Instanz updaten</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/reverse-proxy.html" class="has-background-inherit" >Verwenden eines Reverse-Proxy</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/moderation.html" class="has-background-inherit" >Moderation</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/monitoring-queue.html" class="has-background-inherit" >Überwachungswarteschlange</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/optional_features.html" class="has-background-inherit" >Optionale Funktionen</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/external-storage.html" class="has-background-inherit" >External Storage</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/cli.html" class="has-background-inherit" >Befehlszeilenwerkzeug</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Contributing</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/v0.7.5/de/contributing.html" class="has-background-inherit" >Wie mitmachen</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/translation.html" class="has-background-inherit" >Übersetzungen</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/documentation.html" class="has-background-inherit" >Documentation</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/style_guide.html" class="has-background-inherit" >Stilleitfaden</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/debug_toolbar.html" class="has-background-inherit" >Django Debug-Symbolleiste</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/install-dev.html" class="has-background-inherit" >Developer Environment</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Codebase</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/v0.7.5/de/activitypub.html" class="has-background-inherit" class="is-active">ActivityPub</a>
            </li>
            
            <li>
                <a href="/v0.7.5/de/permissions.html" class="has-background-inherit" >Berechtigungen</a>
            </li>
            
        </ul>
        
    </nav>

    <div class="column">
        <div class="container is-max-desktop">
            <section class="section">
                <header class="content block column is-offset-one-quarter pl-2">
                    
<h1 class="title is-1">ActivityPub</h1>

                </header>
                
<section class="block content">
    <p>BookWyrm verwendet das <a href="http://activitypub.rocks/">ActivityPub</a>-Protokoll, um Benutzer*innenaktivitäten zwischen anderen BookWyrm-Instanzen und anderen Diensten, die ActivityPub implementieren (wie <a href="https://joinmastodon.org/">Mastodon</a>), zu senden und zu empfangen. Um Buchdaten zu handhaben, hat BookWyrm eine Handvoll erweiterter Aktivitätstypen, die nicht zum Standard gehören, aber für andere BookWyrm-Instanzen lesbar sind.</p>
<p>To view the ActivityPub data for a BookWyrm entity (user, book, list, etc) you can usually add <code>.json</code> to the end of the URL. e.g. <code>https://www.example.com/user/sam.json</code> and see the JSON in your web browser or via an http request (e.g. using <code>curl</code>).</p>
<h2 id="aktivitaten-und-objekte"><a class="headerlink" href="#aktivitaten-und-objekte">Aktivitäten und Objekte</a></h2>
<h3 id="benutzerinnen-und-beziehungen"><a class="headerlink" href="#benutzerinnen-und-beziehungen">Benutzer*innen und Beziehungen</a></h3>
<p>Benutzer*innenbeziehungsinteraktionen folgen der Standard ActivityPub Spezifikation.</p>
<ul>
<li><code>Folgen</code>: Bitte, um den Status eine<em>r Benutzer</em>in zu erhalten und anzusehen, die die Privatsphäre auf nur Follower haben</li>
<li><code>Akzeptieren</code>: genehmigt <code>Folgen</code> und erstellt die Beziehung</li>
<li><code>Ablehnen</code>: verweigert <code>Folgen</code></li>
<li><code>Blocken</code>: verhindert, dass Benutzer<em>innen einander Status ansehen und verhindert, dass der blockierte Benutzer</em>innen das Profil des Akteurs ansehen</li>
<li><code>Update</code>: Aktualisiert das Profil und die Einstellungen eine<em>r Benutzer</em>in</li>
<li><code>Löschen</code>: Deaktiviert eine<em>n Benutzer</em>in</li>
<li><code>Rückgängig</code>: Reversiert <code>Folgen</code> oder <code>Blocken</code></li>
<li><code>Move</code>: communicate that a user has changed their ID and has moved to a new server. Most ActivityPub software will "follow" the user to the new identity. BookWyrm sends a notification to followers and requires them to confirm they want to follow the user to their new identity.</li>
</ul>
<h3 id="status"><a class="headerlink" href="#status">Status</a></h3>
<h4 id="objekttypen"><a class="headerlink" href="#objekttypen">Objekttypen</a></h4>
<ul>
<li><code>Notiz</code>: Bei Diensten wie Mastodon, ist <code>Notiz</code>en der primäre Typ des Status. Sie enthalten einen Text, Anhänge, können Benutzer erwähnen und Antworten auf Status jeder Art sein. In BookWyrm können <code>Notiz</code>en nur als direkte Nachrichten oder als Antworten auf andere Status erstellt werden.</li>
<li><code>Rezension</code>: Eine Rezension ist ein Status, der sich auf ein Buch bezieht (angezeigt durch das <code>inReplyToBook</code>-Feld), welches einen Titel, Text sowie die numerische Bewertung auf einer Skala von 0 (keine Bewertung) bis 5 enthält.</li>
<li><code>Kommentar</code>: Ein Kommentar zu einem Buch erwähnt ein Buch und hat einen Text.</li>
<li><code>Zitat</code>: Ein Zitat enthält einen Text, einen Auszug aus dem Buch und erwähnt ein Buch.</li>
</ul>
<h4 id="aktivitaten"><a class="headerlink" href="#aktivitaten">Aktivitäten</a></h4>
<ul>
<li>
<p><code>Erstellen</code>: Speichert einen neuen Status in der Datenbank.</p>
<p><strong>Hinweis</strong>: BookWyrm akzeptiert nur <code>Erstellen</code>-Aktivitäten, wenn sie sind:</p>
<ul>
<li>Direktnachrichten (d.h. <code>Hinweis</code>e mit der Datenschutzstufe <code>direkt</code>, welche einen lokalen Benutzer erwähnen),</li>
<li>Verbunden mit einem Buch (eines benutzerdefinierten Statusstyps, der das Feld <code>inReplyToBook</code> enthält),</li>
<li>Antworten auf existierende Status in der Datenbank</li>
</ul>
</li>
<li>
<p><code>Löschen</code>: Entfernt einen Status</p>
</li>
<li><code>Gefällt</code>: Erstellt einen Favoriten für den Status</li>
<li><code>Ankündigung</code>: Teilt den Status in der Zeitleiste des Akteurs</li>
<li><code>Rückgängig</code>: Reversiert <code>Gefällt</code> oder <code>Ankündigung</code></li>
</ul>
<h3 id="sammlungen"><a class="headerlink" href="#sammlungen">Sammlungen</a></h3>
<p>Bücher und Listen von Benutzern werden durch <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection"><code>Sortierte Sammlung</code></a> repräsentiert</p>
<h4 id="objekte"><a class="headerlink" href="#objekte">Objekte</a></h4>
<ul>
<li><code>Regal</code>: Buchsammlung eines Benutzers. By default, every user has a <code>to-read</code>, <code>reading</code>, <code>stop-reading</code> and <code>read</code> shelf which are used to track reading progress.</li>
<li><code>Liste</code>: Eine Sammlung von Büchern, zu der auch andere Personen als die, die die Liste erstellt hat, Bücher beitragen können.</li>
</ul>
<h4 id="aktivitaten_1"><a class="headerlink" href="#aktivitaten_1">Aktivitäten</a></h4>
<ul>
<li><code>Erstellen</code>: Fügt der Datenbank ein Regal oder eine Liste hinzu.</li>
<li><code>Löschen</code>: Entfernt ein Regal oder eine Liste.</li>
<li><code>Hinzufügen</code>: Fügt ein Buch zu einem Regal oder einer Liste hinzu.</li>
<li><code>Entfernen</code>: Entfernt ein Buch aus einem Regal oder einer Liste.</li>
</ul>
<h2 id="alternative-serialisierung"><a class="headerlink" href="#alternative-serialisierung">Alternative Serialisierung</a></h2>
<p>Weil BookWyrm eigene Objekttypen (<code>Rezension</code>, <code>Kommentar</code>, <code>Zitat</code>) benutzt, die nicht von ActivityPub unterstützt werden, werden Status in Standardtypen umgewandelt, wenn sie an nicht-BookWyrm-Dienste gesendet oder angezeigt werden. <code>Rezension</code>en werden in <code>Artikel</code> umgewandelt und <code>Kommentar</code>e und <code>Zitat</code>e werden in <code>Notiz</code>en mit einem Link zu dem Buch und dem Titelbild als Anhang konvertiert.</p>
<p>This may change in future in favor of the more ActivityPub-compliant <a href="https://www.w3.org/TR/activitystreams-core/#fig-following-is-an-example-object-that-uses-the-id-and-type-properties-to-express-the-global-identifier-and-object-type">extended Object types</a> listed alongside core ActivityPub types.</p>
<h2 id="making-activitypub-aware-models"><a class="headerlink" href="#making-activitypub-aware-models">Making ActivityPub-aware models</a></h2>
<p>The way BookWyrm sends and receives ActivityPub objects can be confusing for developers who are new to BookWyrm. It is mostly controlled by:</p>
<ul>
<li>Functions and <a href="https://docs.python.org/3/library/dataclasses.html">data classes</a> outlined in the <a href="https://github.com/bookwyrm-social/bookwyrm/tree/main/bookwyrm/activitypub">activitypub</a> directory</li>
<li>The <a href="https://github.com/bookwyrm-social/bookwyrm/blob/c458cdcb992a36f3c4a06752499461c3dd991e07/bookwyrm/models/activitypub_mixin.py#L40">ActivitypubMixin</a> and its children for models that are serializable for ActivityPub requests</li>
</ul>
<h3 id="serializing-data-to-and-from-activitypub-json"><a class="headerlink" href="#serializing-data-to-and-from-activitypub-json">Serializing data to and from ActivityPub JSON</a></h3>
<p>BookWyrm needs to know how to <em>serialize</em> the data from the model into an ActivityPub JSON-LD object.</p>
<p>The <code>/activitypub/base_activity.py</code> file provides the core functions that turn ActivityPub JSON-LD strings into usable Django model objects, and vice-versa. We do this by creating a data class in <code>bookwyrm/activitypub</code>, and defining how the model should be serialized by providing an <code>activity_serializer</code> value in the model, which points to the relevant data class. From <code>ActivityObject</code> we inherit <code>id</code> and <code>type</code>, and two <em>class methods</em>:</p>
<p><strong><code>to_model</code></strong></p>
<p>This method takes an ActivityPub JSON string and tries to turn it into a BookWyrm model object, finding an existing object wherever possible. This is how we process <strong>incoming</strong> ActivityPub objects.</p>
<p><strong><code>serialize</code></strong></p>
<p>This method takes a BookWyrm model object, and turns it into a valid ActivityPub JSON string using the dataclass definitions. This is how we process <strong>outgoing</strong> ActivityPub objects.</p>
<h3 id="example-users"><a class="headerlink" href="#example-users">Example - Users</a></h3>
<p>A BookWyrm user <a href="https://github.com/bookwyrm-social/bookwyrm/blob/main/bookwyrm/models/user.py">is defined in <code>models/user.py</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">OrderedCollectionPageMixin</span><span class="p">,</span> <span class="n">AbstractUser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a user who wants to read books&quot;&quot;&quot;</span>
</code></pre></div>

<p>Notice that we are inheriting from ("subclassing") <code>OrderedCollectionPageMixin</code>. This in turn inherits from <code>ObjectMixin</code>, which inherits from <code>ActivitypubMixin</code>. This may seem convoluted, but this inheritence chain allows us to avoid duplicating code as our ActivityPub objects become more specific. <code>AbstractUser</code> is <a href="https://docs.djangoproject.com/en/5.1/topics/auth/customizing/#specifying-custom-user-model">a Django model intended to be subclassed</a>, giving us things like hashed password logins and permission levels "out of the box".</p>
<p>Because <code>User</code> inherits from <a href="https://github.com/bookwyrm-social/bookwyrm/blob/c458cdcb992a36f3c4a06752499461c3dd991e07/bookwyrm/models/activitypub_mixin.py#L213"><code>ObjectMixin</code></a>, when we <code>save()</code> a <code>User</code> object we will send a <code>Create</code> activity (if this is the first time the user was saved) or an <code>Update</code> activity (if we're just saving a change – e.g. to the user description or avatar). Any other model you add to BookWyrm will have the same capability if it inherits from <code>ObjectMixin</code>.</p>
<p>For BookWyrm users, the <code>activity_serializer</code> is defined in the <code>User</code> model:</p>
<div class="highlight"><pre><span></span><code><span class="n">activity_serializer</span> <span class="o">=</span> <span class="n">activitypub</span><span class="o">.</span><span class="n">Person</span>
</code></pre></div>

<p>The data class definition for <code>activitypub.Person</code> is at <code>/activitypub/person.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">ActivityObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;actor activitypub json&quot;&quot;&quot;</span>

    <span class="n">preferredUsername</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">inbox</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">publicKey</span><span class="p">:</span> <span class="n">PublicKey</span>
    <span class="n">followers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">following</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">outbox</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">endpoints</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">icon</span><span class="p">:</span> <span class="n">Image</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bookwyrmUser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">manuallyApprovesFollowers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">discoverable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">hideFollows</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">movedTo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">alsoKnownAs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Person&quot;</span>
</code></pre></div>

<p>You might notice that some of these fields are not a perfect match to the fields in the <code>User</code> model. If you have a field name in your model that needs to be called something different in the ActivityPub object (e.g. to comply with Python naming conventions in the model but JSON naming conventions in JSON string), you can define an <code>activitypub_field</code> in the model field definition:</p>
<div class="highlight"><pre><span></span><code><span class="n">followers_url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">activitypub_field</span><span class="o">=</span><span class="s2">&quot;followers&quot;</span><span class="p">)</span>
</code></pre></div>
</section>

            </section>
        </div>
    </div>
</div>

<footer id="contentinfo" class="footer">
    <div class="container is-max-desktop">
        <div class="columns">
            <div class="column content">
                <p>
                    <strong>BookWyrm</strong> ist eine kollaborative, nicht-kommerzielle Software, die von <a href='https://www.mousereeve.com/'>Mouse Reeve</a> betrieben wird.
                </p>
                <p>
                    Unterstütze BookWyrm auf <a href='https://www.patreon.com/bookwyrm' target='_blank'>Patreon</a>.
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Machen Sie mit</h3>
                <p>
                    <a href="https://github.com/bookwyrm-social">BookWyrm auf GitHub</a>
                </p>
                <p>
                    <a href="https://github.com/bookwyrm-social/documentation/blob/main/content/codebase/activitypub.md">Zu dieser Seite beitragen</a>
                </p>
                <p>
                    <a href="https://twitter.com/BookWyrmSocial" target="_blank">
                        <span class="icon icon-twitter"><span class="is-sr-only">Twitter</span></span>
                    </a>
                    <a href="https://tech.lgbt/@bookwyrm" target="_blank" rel="me">
                        <span class="icon icon-mastodon"><span class="is-sr-only">Mastodon</span></span>
                    </a>
                    <a href="https://www.patreon.com/bookwyrm" target="_blank">
                        <span class="icon icon-patreon"><span class="is-sr-only">Patreon</span></span>
                    </a>
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Mehr erfahren</h3>
                <p>
                    <a href="https://docs.joinbookwyrm.com">Dokumentation</a>
                </p>
                <p>
                    <a href="mailto:mousereeve@riseup.net">Betreiber*in kontaktieren</a>
                </p>
                <p>
                    <a href="https://raw.githubusercontent.com/bookwyrm-social/join-bookwyrm/main/LICENSE.md">Lizenz</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<script>
    var current_locale = "de/";
    var current_version = "v0.7.5";
</script>
<script src="/static/js/bookwyrm.js"></script>
</body>
</html>