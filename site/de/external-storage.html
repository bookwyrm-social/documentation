<!DOCTYPE html>
<html lang="de">
<head>
    <title>
        
Externer Speicher

    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="/static/css/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bulma.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bookwyrm.css">

    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bookwyrm Documentation">
    <meta name="og:title" content="Bookwyrm Documentation">
    <meta name="twitter:description" content="Documentation for using and contributing to BookWyrm">
    <meta name="og:description" content="Documentation for using and contributing to BookWyrm">

    <meta name="twitter:image" content="">
    <meta name="og:image" content="">
    <meta name="twitter:image:alt" content="BookWyrm Logo">

    <meta charset="UTF-8">
</head>
<body>
<nav class="navbar container is-max-desktop" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://joinbookwyrm.com/">
            <img class="image logo" src="/static/images/logo-small.png" alt="Go back to the homepage">
        </a>
    </div>

    <div class="navbar-menu" id="main-nav">
        <div class="navbar-start">
            <a href="https://joinbookwyrm.com/de/instances" class="navbar-item">
                <span class="button is-success has-text-weight-normal has-text-white">Beitreten</span>
            </a>
            <a href="https://joinbookwyrm.com/de/get-involved" class="navbar-item">
                Mitmachen
            </a>
            <a href="https://www.patreon.com/bookwyrm" class="navbar-item">
                Unterstützung
            </a>
            <a href="https://github.com/bookwyrm-social/bookwyrm" class="navbar-item">
                Code
            </a>
            <a href="#" class="navbar-item is-active">
                Dokumentation
            </a>
        </div>
    </div>
    <div class="navbar-end">
        <div class="navbar-item">
            <div class="select">
                <select aria-label="Select a language" id="language_selection">
                    
                    <option value="" >English (US)</option>
                    
                    <option value="de/" selected>Deutsch</option>
                    
                    <option value="fr/" >Français</option>
                    
                    <option value="pl/" >Polski</option>
                    
                    <option value="pt-br/" >Português do Brasil</option>
                    
                    <option value="ro/" >Română</option>
                    
              </select>
            </div>
        </div>
    </div>
</nav>

<div class="container is-max-desktop">
<section class="section">

    <header class="content block column is-offset-one-quarter pl-2">
        
<h1 class="title is-1">Externer Speicher</h1>

    </header>
    <div class="columns">
	<nav class="menu column is-one-quarter mt-2">
        <div class="select">
            <select aria-label="Previous versions" id="version_selection">
                
                <option value="latest" >latest</option>
                
                <option value="v0.7.5" selected>v0.7.5</option>
                
            </select>
        </div>
            <h2 class="menu-label"><a href="/de/">Welcome</a></h2>
            
            <h2 class="menu-label">Using BookWyrm</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/v0.7.5/de/adding-books.html" >Bücher hinzufügen</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/posting-statuses.html" >Posting Statuses</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/lists.html" >Lists</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/privacy-controls.html" >Privacy Controls</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/groups.html" >Groups</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/rss-feeds.html" >RSS Feeds</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/user-migration.html" >User Migration and Aliases</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Running BookWyrm</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/v0.7.5/de/install-prod.html" >Installation in Produktion</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/install-prod-dockerless.html" >Installation ohne Docker</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/updating.html" >Deine Instanz updaten</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/reverse-proxy.html" >Verwenden eines Reverse-Proxy</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/moderation.html" >Moderation</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/monitoring-queue.html" >Überwachungswarteschlange</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/external-storage.html" class="is-active">Externer Speicher</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/optional_features.html" >Optionale Funktionen</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/cli.html" >Befehlszeilenwerkzeug</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Contributing</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/v0.7.5/de/contributing.html" >Wie mitmachen</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/translation.html" >Übersetzungen</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/style_guide.html" >Stilleitfaden</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/install-dev.html" >Developer Environment</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/debug_toolbar.html" >Django Debug-Symbolleiste</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Codebase</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/v0.7.5/de/activitypub.html" >ActivityPub</a>
                </li>
                
                <li>
                    <a href="/v0.7.5/de/permissions.html" >Berechtigungen</a>
                </li>
                
            </ul>
            
        </nav>

        <div class="column">
            
<section class="block content">
    <p>Standardmäßig verwendet BookWyrm lokalen Speicher für statische Assets (Favicon, Standard-Avatar, etc.) und Medien (Benutzer-Avatare, Buchtitelbilder usw.), aber Sie können einen externen Speicherdienst verwenden, um diese Dateien zu bereitzustellen. BookWyrm verwendet <code>django-storages</code>, um externen Speicher wie S3-kompatible Dienste, Apache Libcloud oder SFTP anzubinden.</p>
<h2 id="s3-kompatibler-speicher"><a class="headerlink" href="#s3-kompatibler-speicher">S3-kompatibler Speicher</a></h2>
<h3 id="einrichtung"><a class="headerlink" href="#einrichtung">Einrichtung</a></h3>
<p>Erstellen Sie einen Bucket in Ihrem S3-kompatiblen Dienst der Wahl, zusammen mit einer Zugangsschlüssel-ID und einem geheimen Zugriffsschlüssel. Diese können selbst gehostet sein, wie <a href="https://ceph.io/en/">Ceph</a> (LGPL 2.1/3.0) oder <a href="https://min.io/">MinIO</a> (GNU AGPL v3.0) oder kommerziell (<a href="https://www.scaleway.com/en/docs/object-storage-feature/">Scaleway</a>, <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-digitalocean-space-and-api-key">Digital Ocean</a>…).</p>
<p>Diese Anleitung wurde mit Scaleway Object Storage getestet. Wenn Sie einen anderen Dienst verwenden, teilen Sie bitte Ihre Erfahrungen (insbesondere wenn Sie andere Schritte unternehmen mussten), indem Sie einen Problembericht im <a href="https://github.com/bookwyrm-social/documentation">BookWyrm Dokumentations</a>-Repository einreichen.</p>
<h3 id="was-erwartet-dich"><a class="headerlink" href="#was-erwartet-dich">Was erwartet dich</a></h3>
<p>Wenn du eine neue BookWyrm-Instanz startest, wird der Prozess sein:</p>
<ul>
<li>Richte deinen externen Speicherservice ein</li>
<li>Aktiviere externen Speicher auf BookWyrm</li>
<li>Starte deine BookWyrm-Instanz</li>
<li>Instanz Konnektor aktualisieren</li>
</ul>
<p>Wenn du deine Instanz bereits gestartet hast und Bilder auf den lokalen Speicher hochgeladen wurden, wird der Prozess sein:</p>
<ul>
<li>Richte den externen Speicherdienst ein</li>
<li>Kopiere die lokalen Medien auf externen Speicher</li>
<li>Aktiviere externen Speicher auf BookWyrm</li>
<li>Starte die BookWyrm-Instanz neu</li>
<li>Instanz-Konnektor aktualisieren</li>
</ul>
<h3 id="bookwyrm-einstellungen"><a class="headerlink" href="#bookwyrm-einstellungen">BookWyrm-Einstellungen</a></h3>
<p>Bearbeite die <code>.env</code>-Datei, indem du die folgenden Zeilen auskommentierst:</p>
<ul>
<li><code>AWS_ACCESS_KEY_ID</code>: Ihre Zugangsschlüssel-ID</li>
<li><code>AWS_SECRET_ACCESS_KEY</code>: Ihr geheimer Zugangsschlüssel</li>
<li><code>AWS_STORAGE_BUCKET_NAME</code>: Ihr Bucket Name</li>
<li><code>AWS_S3_REGION_NAME</code>: z.B. <code>"eu-west-1"</code> für AWS, <code>"fr-par"</code> für Scaleway oder <code>"nyc3"</code> für Digital Ocean</li>
</ul>
<p>Wenn dein S3-kompatibler Dienst Amazon AWS ist, solltest du startklar sein. Wenn nicht, musst du folgende Zeilen wieder kommentieren:</p>
<ul>
<li><code>AWS_S3_CUSTOM_DOMAIN</code>: die Domain, die die Assets bereitstellen soll, z.B. <code>"example-bucket-name.s3.fr-par.scw.cloud"</code> oder <code>"${AWS_STORAGE_BUCKET_NAME}.${AWS_S3_REGION_NAME}.digitaloceanspaces.com"</code></li>
<li><code>AWS_S3_ENDPOINT_URL</code>: der S3-API-Endpunkt, z.B. <code>"https://s3.fr-par.scw.cloud"</code> oder <code>"https://${AWS_S3_REGION_NAME}.digitaloceanspaces.com"</code></li>
</ul>
<h3 id="kopieren-lokaler-medien-auf-externen-speicher"><a class="headerlink" href="#kopieren-lokaler-medien-auf-externen-speicher">Kopieren lokaler Medien auf externen Speicher</a></h3>
<p>Wenn die BookWyrm-Instanz bereits läuft und Medien hochgeladen wurden (Benutzer-Avatare, Buchtitelbilder…), musst du hochgeladene Medien in deinen Bucket migrieren.</p>
<p>Diese Aufgabe wird mit dem Befehl erledigt:</p>
<div class="highlight"><pre><span></span><code>./bw-dev<span class="w"> </span>copy_media_to_s3
</code></pre></div>

<h3 id="aktivierung-des-externen-speichers-fur-bookwyrm"><a class="headerlink" href="#aktivierung-des-externen-speichers-fur-bookwyrm">Aktivierung des externen Speichers für BookWyrm</a></h3>
<p>Um den S3-kompatiblen externen Speicher zu aktivieren, müssen Sie Ihre <code>.env</code>-Datei bearbeiten, indem der Eigenschaftswert für <code>USE_S3</code> von <code>false</code> zu <code>true</code> geändert wird:</p>
<div class="highlight"><pre><span></span><code>USE_S3=true
</code></pre></div>

<p>Wenn der externe Speicher über HTTPS ausgeliefert wird (was die meisten dieser Tage sind), musst du auch sicherstellen, dass <code>USE_HTTPS</code> auf <code>true gesetzt ist</code>, damit Bilder über HTTPS geladen werden:</p>
<div class="highlight"><pre><span></span><code>USE_HTTPS=true
</code></pre></div>

<h4 id="statische-assets"><a class="headerlink" href="#statische-assets">Statische Assets</a></h4>
<p>Danach musst du folgenden Befehl ausführen, um die statischen Assets in deinen S3-Bucket zu kopieren:</p>
<div class="highlight"><pre><span></span><code>./bw-dev<span class="w"> </span>collectstatic
</code></pre></div>

<h4 id="cors-einstellungen"><a class="headerlink" href="#cors-einstellungen">CORS-Einstellungen</a></h4>
<p>Sobald die statischen Assets gesammelt sind, musst du Sie CORS für deinen Bucket einrichten.</p>
<p>Einige Dienste wie Digital Ocean bieten eine Schnittstelle, um es einzurichten, siehe <a href="https://docs.digitalocean.com/products/spaces/how-to/configure-cors/">Digital Ocean doc: Wie man CORS konfiguriert</a>.</p>
<p>Wenn dein Dienst keine Schnittstelle zur Verfügung stellt, kannst du CORS trotzdem mit der Befehlszeile einrichten.</p>
<p>Erstelle eine Datei namens <code>cors.json</code> mit folgendem Inhalt:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;CORSRules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;AllowedOrigins&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://MY_DOMAIN_NAME&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;https://www.MY_DOMAIN_NAME&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;AllowedHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;AllowedMethods&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HEAD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DELETE&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;MaxAgeSeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ExposeHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Etag&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>Ersetzen Sie <code>MY_DOMAIN_NAME</code> durch den/die Domainname(n) Ihrer Instanz.</p>
<p>Führe dann den folgenden Befehl aus:</p>
<div class="highlight"><pre><span></span><code>./bw-dev<span class="w"> </span>set_cors_to_s3<span class="w"> </span>cors.json
</code></pre></div>

<p>Keine Ausgabe bedeutet, dass es gut sein sollte.</p>
<p>Wenn du eine neue BookWyrm-Instanz startest, kannst du sofort zu den Installationsanweisungen zurückkehren. Wenn nicht, lese weiter.</p>
<h3 id="starte-deine-instanz-neu"><a class="headerlink" href="#starte-deine-instanz-neu">Starte deine Instanz neu</a></h3>
<p>Sobald die Medienmigration abgeschlossen und die statischen Assets gesammelt wurden, kannst du die neue <code>.env</code>-Konfiguration laden und die Instanz neustarten mit:</p>
<div class="highlight"><pre><span></span><code>./bw-dev<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>

<p>Wenn alles gut geht, wurde dein Speicher ohne Serverausfall geändert. Wenn einige Schriftarten fehlen (und die Browser-JS-Konsole mit Warnung über CORS aufwartet), schlug etwas <a href="#cors-settings">hier</a> fehl. In diesem Fall kann es gut sein, die Header einer HTTP-Anfrage auf eine Datei in deinem Bucket zu überprüfen:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>OPTIONS<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Origin: http://MY_DOMAIN_NAME&#39;</span><span class="w"> </span>http://BUCKET_URL/static/images/logo-small.png<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Access-Control-Request-Method: GET&quot;</span>
</code></pre></div>

<p>Ersetze <code>MY_DOMAIN_NAME</code> durch deinen Domain-Namen, <code>BUCKET_URL</code> mit der URL für deinen Bucket, du kannst den Dateipfad durch jeden anderen gültigen Pfad in deinem Bucket ersetzen.</p>
<p>Wenn du eine Nachricht siehst, insbesondere eine Nachricht, die mit <code>&lt;Error&gt;&lt;Code&gt;CORSForbidden&lt;/Code&gt;</code> beginnt, funktionierte sie nicht. Wenn du keine Nachricht siehst, funktioniert es.</p>
<p>Für eine aktive Instanz kann es eine Handvoll Dateien geben, die während der Zeit zwischen der Migration der Dateien auf den externen Speicher lokal erstellt wurden und ein Neustarten der App nutzt den externen Speicher. Um sicherzustellen, dass alle noch verbleibenden Dateien nach dem Umschalten auf den externen Speicher hochgeladen werden, kannst du folgenden Befehl verwenden, der nur Dateien hochlädt, die nicht bereits im externen Speicher vorhanden sind:</p>
<div class="highlight"><pre><span></span><code>./bw-dev<span class="w"> </span>sync_media_to_s3
</code></pre></div>

<h3 id="instanz-konnektor-aktualisieren"><a class="headerlink" href="#instanz-konnektor-aktualisieren">Instanz-Konnektor aktualisieren</a></h3>
<p><em>Hinweis: Du kannst diesen Schritt überspringen, wenn du eine aktualisierte Version von BookWyrm verwendest; im September 2021 wurde der "Selbst-Steckverbinder" in <a href="https://github.com/bookwyrm-social/bookwyrm/pull/1413">PR #1413</a> entfernt</em></p>
<p>Damit die richtige URL für die Anzeige lokaler Buchsuchergebnisse verwendet wird, müssen wir den Wert für die URL-Basis der Titelbilder ändern.</p>
<p>Konnektor-Daten können über die Django-Admin-Schnittstelle unter der URL <code>http://MY_DOMAIN_NAME/admin</code> aufgerufen werden. Der Konnektor für deine eigene Instanz ist der erste Datensatz in der Datenbank, damit du auf den Konnektor mit dieser URL zugreifen kannst: <code>https://MY_DOMAIN_NAME/admin/bookwyrm/connector/1/change/</code>.</p>
<p>Das Feld <em>Covers url</em> ist standardmäßig als <code>https://MY_DOMAIN_NAME/images</code>definiert, Sie müssen es auf <code>https://S3_STORAGE_URL/images</code> ändern. Klicke auf <em>Speichern</em> und voilà!</p>
<p>Du musst den Wert für die <em>Covers Url</em> jedes Mal aktualisieren, wenn du die URL für deinen Speicher änderst.</p>
</section>

        </div>
    </div>
</section>
</div>

<footer id="contentinfo" class="footer">
    <div class="container is-max-desktop">
        <div class="columns">
            <div class="column content">
                <p>
                    <strong>BookWyrm</strong> ist eine kollaborative, nicht-kommerzielle Software, die von <a href='https://www.mousereeve.com/'>Mouse Reeve</a> betrieben wird.
                </p>
                <p>
                    Unterstütze BookWyrm auf <a href='https://www.patreon.com/bookwyrm' target='_blank'>Patreon</a>.
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Machen Sie mit</h3>
                <p>
                    <a href="https://github.com/bookwyrm-social">BookWyrm auf GitHub</a>
                </p>
                <p>
                    <a href="https://github.com/bookwyrm-social/documentation/blob/main/content/running_bookwyrm/external-storage.md">Zu dieser Seite beitragen</a>
                </p>
                <p>
                    <a href="https://twitter.com/BookWyrmSocial" target="_blank">
                        <span class="icon icon-twitter"><span class="is-sr-only">Twitter</span></span>
                    </a>
                    <a href="https://tech.lgbt/@bookwyrm" target="_blank" rel="me">
                        <span class="icon icon-mastodon"><span class="is-sr-only">Mastodon</span></span>
                    </a>
                    <a href="https://www.patreon.com/bookwyrm" target="_blank">
                        <span class="icon icon-patreon"><span class="is-sr-only">Patreon</span></span>
                    </a>
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Mehr erfahren</h3>
                <p>
                    <a href="https://docs.joinbookwyrm.com">Dokumentation</a>
                </p>
                <p>
                    <a href="mailto:mousereeve@riseup.net">Betreiber*in kontaktieren</a>
                </p>
                <p>
                    <a href="https://raw.githubusercontent.com/bookwyrm-social/join-bookwyrm/main/LICENSE.md">Lizenz</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
    (function() {
        var languageSelector = document.getElementById("language_selection");
        languageSelector.onchange = function(event) {
            var current_locale = "de/";
            var current_location = window.location.pathname;

            var locale_index = current_location.indexOf(current_locale);
            var new_location = "/" + event.target.value;

            if (locale_index) {
                // we're in a locale - swap it out
                new_location = current_location.replace(current_locale, event.target.value)
            } else {
                // are we in a version?
                var regx = /\/v[0-9\.]+/
                if (regx.test(current_location)) {
                    // split current location
                    arr = current_location.split("/")
                    // insert new locale
                    arr.splice(2, 0, event.target.value.replace("/", ""))
                    // gather it all together again
                    new_location = arr.join("/")
                } else {
                    new_location += current_location.slice(1);
                }
            }
            window.location = new_location;
        }
    })()
</script>
<script type="text/javascript">
    (function() {
        var versionSelector = document.getElementById("version_selection");
        versionSelector.onchange = function(event) {
            current_version = "v0.7.5"
            var current_location = window.location.pathname;
            var target_version = event.target.value == "latest" ? "" : event.target.value;
            var arr = current_location.split("/")
            var regx = /\/v[0-9\.]+/
            if (regx.test(current_location)) {
                window.location = window.location.href.replace(regx,`${target_version}`)
            } else {
                window.location = `/${target_version}${current_location}`
            }
        }
    })()
</script>


</body>
</html>