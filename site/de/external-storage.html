<!DOCTYPE html>
<html lang="de">
<head>
    <title>
        
Externer Speicher

    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="/static/css/bookwyrm.css">
    <link type="text/css" rel="stylesheet" href="/static/css/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bulma.min.css">

    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bookwyrm Documentation">
    <meta name="og:title" content="Bookwyrm Documentation">
    <meta name="twitter:description" content="Documentation for using and contributing to BookWyrm">
    <meta name="og:description" content="Documentation for using and contributing to BookWyrm">

    <meta name="twitter:image" content="">
    <meta name="og:image" content="">
    <meta name="twitter:image:alt" content="BookWyrm Logo">

    <meta charset="UTF-8">
</head>
<body>
<nav class="navbar container is-max-desktop" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://joinbookwyrm.com/">
            <img class="image logo" src="/static/images/logo-small.png" alt="Go back to the homepage">
        </a>
    </div>

    <div class="navbar-menu" id="main-nav">
        <div class="navbar-start">
            <a href="https://joinbookwyrm.com/de/instances" class="navbar-item">
                <span class="button is-success">Beitreten</span>
            </a>
            <a href="https://joinbookwyrm.com/de/get-involved" class="navbar-item">
                Machen Sie mit
            </a>
            <a href="https://www.patreon.com/bookwyrm" class="navbar-item">
                Unterstützung
            </a>
            <a href="https://github.com/bookwyrm-social/bookwyrm" class="navbar-item">
                Code
            </a>
            <a href="#" class="navbar-item is-active">
                Dokumentation
            </a>
        </div>
    </div>
    <div class="navbar-end">
        <div class="navbar-item">
            <div class="select">
                <select aria-label="Select a language" id="language_selection">
                    
                    <option value="" >English (US)</option>
                    
                    <option value="de/" selected>Deutsch</option>
                    
                    <option value="fr/" >Français</option>
                    
                    <option value="pl/" >Polski</option>
                    
                    <option value="pt-br/" >Português do Brasil</option>
                    
                    <option value="ro/" >Română</option>
                    
              </select>
            </div>
        </div>
    </div>
</nav>

<div class="container is-max-desktop">
<section class="section">

    <header class="content block column is-offset-one-quarter pl-2">
        
<h1 class="title is-1">Externer Speicher</h1>

    </header>
    <div class="columns">
	<nav class="menu column is-one-quarter mt-2">
            <h2 class="menu-label"><a href="/de/">Welcome</a></h2>
            
            <h2 class="menu-label">Using BookWyrm</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/de/posting-statuses.html" >Beitragsstatus</a>
                </li>
                
                <li>
                    <a href="/de/adding-books.html" >Bücher hinzufügen</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Running BookWyrm</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/de/install-prod.html" >Installation in Produktion</a>
                </li>
                
                <li>
                    <a href="/de/updating.html" >Aktualisieren Ihrer Instanz</a>
                </li>
                
                <li>
                    <a href="/de/reverse-proxy.html" >Verwenden eines Reverse-Proxy</a>
                </li>
                
                <li>
                    <a href="/de/moderation.html" >Moderation</a>
                </li>
                
                <li>
                    <a href="/de/external-storage.html" class="is-active">Externer Speicher</a>
                </li>
                
                <li>
                    <a href="/de/optional_features.html" >Optionale Funktionen</a>
                </li>
                
                <li>
                    <a href="/de/cli.html" >Befehlszeilenwerkzeug</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Contributing</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/de/contributing.html" >Wie mitmachen</a>
                </li>
                
                <li>
                    <a href="/de/translation.html" >Übersetzungen</a>
                </li>
                
                <li>
                    <a href="/de/install-dev.html" >Entwicklungsumgebung</a>
                </li>
                
                <li>
                    <a href="/de/style_guide.html" >Stilleitfaden</a>
                </li>
                
                <li>
                    <a href="/de/debug_toolbar.html" >Django Debug-Symbolleiste</a>
                </li>
                
            </ul>
            
            <h2 class="menu-label">Codebase</h2>
            <ul class="menu-list">
                
                <li>
                    <a href="/de/activitypub.html" >ActivityPub</a>
                </li>
                
                <li>
                    <a href="/de/permissions.html" >Berechtigungen</a>
                </li>
                
            </ul>
            
        </nav>

        <div class="column">
            
<section class="block content">
    <p>Standardmäßig verwendet BookWyrm lokalen Speicher für statische Assets (Favicon, Standard-Avatar, etc.) und Medien (Benutzer-Avatare, Buchtitelbilder usw.), aber Sie können einen externen Speicherdienst verwenden, um diese Dateien zu bereitzustellen. BookWyrm verwendet <code>django-storages</code>, um externen Speicher wie S3-kompatible Dienste, Apache Libcloud oder SFTP anzubinden.</p>
<h2>S3-kompatibler Speicher</h2>
<h3>Einrichtung</h3>
<p>Erstellen Sie einen Bucket in Ihrem S3-kompatiblen Dienst der Wahl, zusammen mit einer Zugangsschlüssel-ID und einem geheimen Zugriffsschlüssel. Diese können selbst gehostet sein, wie <a href="https://ceph.io/en/">Ceph</a> (LGPL 2.1/3.0) oder <a href="https://min.io/">MinIO</a> (GNU AGPL v3.0) oder kommerziell (<a href="https://www.scaleway.com/en/docs/object-storage-feature/">Scaleway</a>, <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-digitalocean-space-and-api-key">Digital Ocean</a>…).</p>
<p>Diese Anleitung wurde mit Scaleway Object Storage getestet. Wenn Sie einen anderen Dienst verwenden, teilen Sie bitte Ihre Erfahrungen (insbesondere wenn Sie andere Schritte unternehmen mussten), indem Sie einen Problembericht im <a href="https://github.com/bookwyrm-social/documentation">BookWyrm Dokumentations</a>-Repository einreichen.</p>
<h3>Was erwartet Sie</h3>
<p>Wenn Sie eine neue BookWyrm-Instanz starten, wird der Prozess sein:</p>
<ul>
<li>Richten Sie Ihren externen Speicherservice ein</li>
<li>Aktiviere externen Speicher auf BookWyrm</li>
<li>Starten Sie Ihre BookWyrm-Instanz</li>
<li>Instanz Konnektor aktualisieren</li>
</ul>
<p>Wenn Sie Ihre Instanz bereits gestartet haben und Bilder auf den lokalen Speicher hochgeladen wurden, wird der Prozess sein:</p>
<ul>
<li>Richten Sie Ihren externen Speicherdienst ein</li>
<li>Kopieren Sie Ihre lokalen Medien auf externen Speicher</li>
<li>Aktiviere externen Speicher auf BookWyrm</li>
<li>Starten Sie Ihre BookWyrm-Instanz neu</li>
<li>Instanz-Konnektor aktualisieren</li>
</ul>
<h3>BookWyrm-Einstellungen</h3>
<p>Bearbeiten Sie Ihre <code>.env</code>-Datei, indem Sie die folgenden Zeilen auskommentieren:</p>
<ul>
<li><code>AWS_ACCESS_KEY_ID</code>: Ihre Zugangsschlüssel-ID</li>
<li><code>AWS_SECRET_ACCESS_KEY</code>: Ihr geheimer Zugangsschlüssel</li>
<li><code>AWS_STORAGE_BUCKET_NAME</code>: Ihr Bucket Name</li>
<li><code>AWS_S3_REGION_NAME</code>: z.B. <code>"eu-west-1"</code> für AWS, <code>"fr-par"</code> für Scaleway oder <code>"nyc3"</code> für Digital Ocean</li>
</ul>
<p>Wenn Ihr S3-kompatibler Dienst Amazon AWS ist, sollten Sie startklar sein. Wenn nicht, müssen Sie die folgenden Zeilen wieder kommentieren:</p>
<ul>
<li><code>AWS_S3_CUSTOM_DOMAIN</code>: die Domain, die die Assets bereitstellen soll, z.B. <code>"example-bucket-name.s3.fr-par.scw.cloud"</code> oder <code>"${AWS_STORAGE_BUCKET_NAME}.${AWS_S3_REGION_NAME}.digitaloceanspaces.com"</code></li>
<li><code>AWS_S3_ENDPOINT_URL</code>: der S3-API-Endpunkt, z.B. <code>"https://s3.fr-par.scw.cloud"</code> oder <code>"https://${AWS_S3_REGION_NAME}.digitaloceanspaces.com"</code></li>
</ul>
<h3>Kopieren lokaler Medien auf externen Speicher</h3>
<p>Wenn Ihre BookWyrm-Instanz bereits läuft und Medien hochgeladen wurden (Benutzer-Avatare, Buchtitelbilder…), müssen Sie hochgeladene Medien in Ihren Bucket migrieren.</p>
<p>Diese Aufgabe wird mit dem Befehl erledigt:</p>
<pre><code class="language-bash">./bw-dev copy_media_to_s3
</code></pre>
<h3>Aktivierung des externen Speichers für BookWyrm</h3>
<p>Um den S3-kompatiblen externen Speicher zu aktivieren, müssen Sie Ihre <code>.env</code>-Datei bearbeiten, indem der Eigenschaftswert für <code>USE_S3</code> von <code>false</code> zu <code>true</code> geändert wird:</p>
<pre><code>USE_S3=true
</code></pre>
<p>Wenn Ihr externer Speicher über HTTPS ausgeliefert wird (was die meisten dieser Tage sind), müssen Sie auch sicherstellen, dass <code>USE_HTTPS</code> auf <code>true gesetzt ist</code>, damit Bilder über HTTPS geladen werden:</p>
<pre><code>USE_HTTPS=true
</code></pre>
<h4>Statische Assets</h4>
<p>Danach müssen Sie den folgenden Befehl ausführen, um die statischen Assets in Ihren S3-Bucket zu kopieren:</p>
<pre><code class="language-bash">./bw-dev collectstatic
</code></pre>
<h4>CORS-Einstellungen</h4>
<p>Sobald die statischen Assets gesammelt sind, müssen Sie CORS für Ihren Bucket einrichten.</p>
<p>Einige Dienste wie Digital Ocean bieten eine Schnittstelle, um es einzurichten, siehe <a href="https://docs.digitalocean.com/products/spaces/how-to/configure-cors/">Digital Ocean doc: Wie man CORS konfiguriert</a>.</p>
<p>Wenn Ihr Dienst keine Schnittstelle zur Verfügung stellt, können Sie CORS trotzdem mit der Befehlszeile einrichten.</p>
<p>Erstelle eine Datei namens <code>cors.json</code> mit folgendem Inhalt:</p>
<pre><code class="language-json">{
  &quot;CORSRules&quot;: [
    {
      &quot;AllowedOrigins&quot;: [&quot;https://MY_DOMAIN_NAME&quot;, &quot;https://www.MY_DOMAIN_NAME&quot;],
      &quot;AllowedHeaders&quot;: [&quot;*&quot;],
      &quot;AllowedMethods&quot;: [&quot;GET&quot;, &quot;HEAD&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;],
      &quot;MaxAgeSeconds&quot;: 3000,
      &quot;ExposeHeaders&quot;: [&quot;Etag&quot;]
    }
  ]
}
</code></pre>
<p>Ersetzen Sie <code>MY_DOMAIN_NAME</code> durch den/die Domainname(n) Ihrer Instanz.</p>
<p>Führen Sie dann den folgenden Befehl aus:</p>
<pre><code class="language-bash">./bw-dev set_cors_to_s3 cors.json
</code></pre>
<p>Keine Ausgabe bedeutet, dass es gut sein sollte.</p>
<p>Wenn Sie eine neue BookWyrm-Instanz starten, können Sie sofort zu den Installationsanweisungen zurückkehren. Wenn nicht, lesen Sie weiter.</p>
<h3>Aktualisiere deine Instanz</h3>
<p>Sobald die Medienmigration abgeschlossen und die statischen Assets gesammelt wurden, können Sie die neue <code>.env</code>-Konfiguration laden und Ihre Instanz neustarten mit:</p>
<pre><code class="language-bash">./bw-dev up -d
</code></pre>
<p>Wenn alles gut geht, wurde Ihr Speicher ohne Serverausfall geändert. Wenn einige Schriftarten fehlen (und Ihre Browser-JS-Konsole mit Warnung über CORS aufwartet), schlug etwas <a href="#cors-settings">hier</a> fehl. In diesem Fall kann es gut sein, die Header einer HTTP-Anfrage auf eine Datei in Ihrem Bucket zu überprüfen:</p>
<pre><code class="language-bash">curl -X OPTIONS -H 'Origin: http://MY_DOMAIN_NAME' http://BUCKET_URL/static/images/logo-small.png -H &quot;Access-Control-Request-Method: GET&quot;
</code></pre>
<p>Ersetzen Sie <code>MY_DOMAIN_NAME</code> durch Ihren Domain-Namen, <code>BUCKET_URL</code> mit der URL für Ihren Bucket, Sie können den Dateipfad durch jeden anderen gültigen Pfad in Ihrem Bucket ersetzen.</p>
<p>Wenn Sie eine Nachricht sehen, insbesondere eine Nachricht, die mit <code>&lt;Error&gt;&lt;Code&gt;CORSForbidden&lt;/Code&gt;</code> beginnt, funktionierte sie nicht. Wenn Sie keine Nachricht sehen, funktionierte es.</p>
<p>Für eine aktive Instanz kann es eine Handvoll Dateien geben, die während der Zeit zwischen der Migration der Dateien auf den externen Speicher lokal erstellt wurden und ein Neustarten der App nutzt den externen Speicher. Um sicherzustellen, dass alle noch verbleibenden Dateien nach dem Umschalten auf den externen Speicher hochgeladen werden, können Sie den folgenden Befehl verwenden, der nur Dateien hochlädt, die nicht bereits im externen Speicher vorhanden sind:</p>
<pre><code class="language-bash">./bw-dev sync_media_to_s3
</code></pre>
<h3>Instanz-Konnektor aktualisieren</h3>
<p><em>Hinweis: Sie können diesen Schritt überspringen, wenn Sie eine aktualisierte Version von BookWyrm verwenden; im September 2021 wurde der "Selbst-Steckverbinder" in <a href="https://github.com/bookwyrm-social/bookwyrm/pull/1413">PR #1413</a> entfernt</em></p>
<p>Damit die richtige URL für die Anzeige lokaler Buchsuchergebnisse verwendet wird, müssen wir den Wert für die URL-Basis der Titelbilder ändern.</p>
<p>Konnektor-Daten können über die Django-Admin-Schnittstelle unter der URL <code>http://MY_DOMAIN_NAME/admin</code> aufgerufen werden. Der Konnektor für Ihre eigene Instanz ist der erste Datensatz in der Datenbank, damit Sie auf den Konnektor mit dieser URL zugreifen können: <code>https://MY_DOMAIN_NAME/admin/bookwyrm/connector/1/change/</code>.</p>
<p>Das Feld <em>Covers url</em> ist standardmäßig als <code>https://MY_DOMAIN_NAME/images</code>definiert, Sie müssen es auf <code>https://S3_STORAGE_URL/images</code> ändern. Klicken Sie dann auf <em>Speichern</em> und voilà!</p>
<p>Sie müssen den Wert für die <em>Covers Url</em> jedes Mal aktualisieren, wenn Sie die URL für Ihren Speicher ändern.</p>
</section>

        </div>
    </div>
</section>
</div>

<footer id="contentinfo" class="footer">
    <div class="container is-max-desktop">
        <div class="columns">
            <div class="column content">
                <p>
                    <strong>BookWyrm</strong> ist eine kollaborative, nichtkommerzielle Software, die von <a href='https://www.mousereeve.com/'>Mouse Reeve</a> betrieben wird.
                </p>
                <p>
                    Unterstütze BookWyrm auf <a href='https://www.patreon.com/bookwyrm' target='_blank'>Patreon</a>.
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Machen Sie mit</h3>
                <p>
                    <a href="https://github.com/bookwyrm-social">BookWyrm auf GitHub</a>
                </p>
                <p>
                    <a href="https://github.com/bookwyrm-social/join-bookwyrm">Zu dieser Seite beitragen</a>
                </p>
                <p>
                    <a href="https://twitter.com/BookWyrmSocial" target="_blank">
                        <span class="icon icon-twitter"><span class="is-sr-only">Twitter</span></span>
                    </a>
                    <a href="https://tech.lgbt/@bookwyrm" target="_blank" rel="me">
                        <span class="icon icon-mastodon"><span class="is-sr-only">Mastodon</span></span>
                    </a>
                    <a href="https://www.patreon.com/bookwyrm" target="_blank">
                        <span class="icon icon-patreon"><span class="is-sr-only">Patreon</span></span>
                    </a>
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Mehr erfahren</h3>
                <p>
                    <a href="https://docs.joinbookwyrm.com">Dokumentation</a>
                </p>
                <p>
                    <a href="mailto:mousereeve@riseup.net">Betreiber*in kontaktieren</a>
                </p>
                <p>
                    <a href="https://raw.githubusercontent.com/bookwyrm-social/join-bookwyrm/main/LICENSE.md">Lizenz</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
    (function() {
        var languageSelector = document.getElementById("language_selection");
        languageSelector.onchange = function(event) {
            var current_locale = "de/";
            var current_location = window.location.pathname;

            var locale_index = current_location.indexOf(current_locale);
            var new_location = "/" + event.target.value;

            if (locale_index) {
                new_location += current_location.slice(locale_index + current_locale.length);
            } else {
                new_location += current_location.slice(1);
            }

            window.location = new_location;
        }
    })()
</script>

</body>
</html>