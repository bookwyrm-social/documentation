<!DOCTYPE html>
<html lang="pt">
<head>
    <title>
        
Installing in Production

    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="/static/css/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bulma.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bookwyrm.css?v076">

    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bookwyrm Documentation">
    <meta name="og:title" content="Bookwyrm Documentation">
    <meta name="twitter:description" content="Documentation for using and contributing to BookWyrm">
    <meta name="og:description" content="Documentation for using and contributing to BookWyrm">

    <meta name="twitter:image" content="">
    <meta name="og:image" content="">
    <meta name="twitter:image:alt" content="BookWyrm Logo">

    <meta charset="UTF-8">
</head>
<body>
<nav class="navbar container is-max-desktop" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://joinbookwyrm.com/">
            <img class="image logo" src="/static/images/logo-small.png" alt="Go back to the homepage">
        </a>
        <a href="/" class="navbar-item has-text-link has-text-weight-bold">
            Documentação
        </a>
        <a role="button" class="navbar-burger" data-target="main-nav" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>

    <div class="navbar-menu" id="main-nav">
        <div class="navbar-start">
            <a href="https://joinbookwyrm.com/pt-br/instances" class="navbar-item">
                Registrar
            </a>
            <a href="https://joinbookwyrm.com/pt-br/get-involved" class="navbar-item">
                Participe
            </a>
            <a href="https://www.patreon.com/bookwyrm" class="navbar-item">
                Suporte
            </a>
            <a href="https://github.com/bookwyrm-social/bookwyrm" class="navbar-item">
                Código
            </a>
        </div>
    </div>
</nav>

<div class="columns">
    <nav class="menu column is-one-quarter is-hidden-touch pl-6 mt-4" id="menu">
        <h2 class="menu-label">Language & Version</a></h2>
        <div class="select">
            <select aria-label="Select a language" id="language_selection">
                
                <option value="" >English (US)</option>
                
                <option value="de/" >Deutsch</option>
                
                <option value="fr/" >Français</option>
                
                <option value="pl/" >Polski</option>
                
                <option value="pt-br/" selected>Português do Brasil</option>
                
                <option value="ro/" >Română</option>
                
          </select>
        </div>
        <div class="select">
            <select aria-label="Previous versions" id="version_selection">
                
                <option value="latest" >latest</option>
                
                <option value="v0.7.5" >v0.7.5</option>
                
            </select>
        </div>
        
        <h2 class="menu-label">Using BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/pt-br/posting-statuses.html" class="has-background-inherit" >Posting Statuses</a>
            </li>
            
            <li>
                <a href="/pt-br/privacy-controls.html" class="has-background-inherit" >Privacy Controls</a>
            </li>
            
            <li>
                <a href="/pt-br/adding-books.html" class="has-background-inherit" >Adicionar livros</a>
            </li>
            
            <li>
                <a href="/pt-br/lists.html" class="has-background-inherit" >Lists</a>
            </li>
            
            <li>
                <a href="/pt-br/groups.html" class="has-background-inherit" >Groups</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Running BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/pt-br/install-prod.html" class="has-background-inherit" class="is-active">Installing in Production</a>
            </li>
            
            <li>
                <a href="/pt-br/install-prod-dockerless.html" class="has-background-inherit" >Installing Without Docker</a>
            </li>
            
            <li>
                <a href="/pt-br/updating.html" class="has-background-inherit" >Updating Your Instance</a>
            </li>
            
            <li>
                <a href="/pt-br/reverse-proxy.html" class="has-background-inherit" >Using a Reverse-Proxy</a>
            </li>
            
            <li>
                <a href="/pt-br/moderation.html" class="has-background-inherit" >Moderation</a>
            </li>
            
            <li>
                <a href="/pt-br/monitoring-queue.html" class="has-background-inherit" >Monitoring Queue</a>
            </li>
            
            <li>
                <a href="/pt-br/external-storage.html" class="has-background-inherit" >External Storage</a>
            </li>
            
            <li>
                <a href="/pt-br/optional_features.html" class="has-background-inherit" >Optional features</a>
            </li>
            
            <li>
                <a href="/pt-br/cli.html" class="has-background-inherit" >Command Line Tool</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Contributing</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/pt-br/style_guide.html" class="has-background-inherit" ></a>
            </li>
            
            <li>
                <a href="/pt-br/contributing.html" class="has-background-inherit" ></a>
            </li>
            
            <li>
                <a href="/pt-br/translation.html" class="has-background-inherit" ></a>
            </li>
            
            <li>
                <a href="/pt-br/install-dev.html" class="has-background-inherit" >Developer Environment</a>
            </li>
            
            <li>
                <a href="/pt-br/debug_toolbar.html" class="has-background-inherit" >Django Debug Toolbar</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Codebase</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/pt-br/activitypub.html" class="has-background-inherit" ></a>
            </li>
            
            <li>
                <a href="/pt-br/permissions.html" class="has-background-inherit" >Permissões</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Reference Guides</h2>
        <ul class="menu-list has-background-inherit">
            
        </ul>
        
    </nav>

    <div class="column">
        <div class="container is-max-desktop">
            <section class="section">
                <header class="content block column is-offset-one-quarter pl-2">
                    
<h1 class="title is-1">Installing in Production</h1>

                </header>
                
<section class="block content">
    <p>Este projeto ainda é jovem e não está, no momento, muito estável, então tenha cuidado ao rodá-lo em produção.</p>
<h2 id="configuracao-do-servidor"><a class="headerlink" href="#configuracao-do-servidor">Configuração do servidor</a></h2>
<ul>
<li>Obtenha um domínio e configure o DNS para seu servidor. Você deverá apontar os nameservers do seu domínio no provedor de DNS ao servidor onde você hospedará a BookWyrm. Aqui estão as instruções para a <a href="https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars">DigitalOcean</a></li>
<li>Configure o seu servidor com firewalls adequados a uma aplicação web (estas instruções foram testadas no Ubuntu 20.04). Aqui estão as instruções para a <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04">DigitalOcean</a></li>
<li>Configure um serviço de email (como o <a href="https://documentation.mailgun.com/en/latest/quickstart.html">Mailgun</a>) e as configurações corretas de SMTP/DNS. Use a documentação do serviço para configurar seu DNS</li>
<li><a href="https://docs.docker.com/compose/install/">Instale o Docker e docker-compose</a></li>
</ul>
<h2 id="instale-e-configure-a-bookwyrm"><a class="headerlink" href="#instale-e-configure-a-bookwyrm">Instale e configure a BookWyrm</a></h2>
<p>O branch <code>produção (production)</code> da BookWyrm tem uma série de ferramentas indisponíveis no branch <code>principal (main)</code> que servem para a execução em produção, como alterações no <code>docker-compose</code> para atualizar os comandos padrão, configuração de containers e alterações individuais nas configurações dos containers para ativar coisas com SSL ou backups comuns.</p>
<p>Instruções para rodar a BookWyrm em produção:</p>
<ul>
<li>Obtenha o código da aplicação: <code>git clone git@github.com:bookwyrm-social/bookwyrm.git</code></li>
<li>Mude para o branch <code>produção (production)</code>: <code>git checkout production</code></li>
<li>Crie seu arquivo de variáveis do ambiente, <code>cp .env.example .env</code>, e atualize o seguinte:<ul>
<li><code>SECRET_KEY</code> | Uma string de caracteres difíceis de descobrir</li>
<li><code>DOMAIN</code> | Seu domínio</li>
<li><code>EMAIL</code> | Um endereço de email para ser usado na verificação de domínio do certbot</li>
<li><code>POSTGRES_PASSWORD</code> | Defina uma senha segura para o banco de dados</li>
<li><code>REDIS_ACTIVITY_PASSWORD</code> | Defina uma senha segura para o subsistema Redis Activity</li>
<li><code>REDIS_BROKER_PASSWORD</code> | Defina uma senha segura para o subsistema Redis queue broker</li>
<li><code>FLOWER_USER</code> | Seu nome de usuário para acessar o monitor de filas Flower</li>
<li><code>FLOWER_PASSWORD</code> | Sua senha segura para acessar o monitor de filas Flower</li>
<li><code>EMAIL_HOST_USER</code> | O endereço do recipiente que o aplicativo usará para enviar emails</li>
<li><code>EMAIL_HOST_PASSWORD</code> | A senha do seu serviço de email</li>
</ul>
</li>
<li>Configure o nginx<ul>
<li>Faça uma cópia do template da configuração de produção e ative-o no ngix <code>cp nginx/production nginx/default.conf</code></li>
<li>Atualize o <code>nginx/default.conf</code>:<ul>
<li>Substitua <code>your-domain.com</code> com seu domínio em todos os lugares do arquivo (incluindo as linhas comentadas)</li>
<li>Se você não estiver utilizando o subdomínio <code>www</code>, exclua a versão do domínio www.your-domain.com do <code>server_name</code> no primeiro bloco server no <code>nginx/default.conf</code> e exclua a flag <code>-d www.${DOMAIN}</code> no fim do comando <code>certbot</code> no <code>docker-compose.yml</code>.</li>
<li>If you are running another web-server on your host machine, you will need to follow the <a href="/reverse-proxy.html">reverse-proxy instructions</a></li>
</ul>
</li>
</ul>
</li>
<li>Initialize the database by running <code>./bw-dev migrate</code></li>
<li>Rode a aplicação (e isso deve também configurar o certificado ssl do Certbot para seu domínio) com <code>docker-compose up --build</code>, e certifique-se de que todas as imagens foram construidas com sucesso<ul>
<li>If you are running other services on your host machine, you may run into errors where services fail when attempting to bind to a port. See the <a href="#port_conflicts">troubleshooting guide</a> for advice on resolving this.</li>
</ul>
</li>
<li>When docker has built successfully, stop the process with <code>CTRL-C</code></li>
<li>Set up HTTPS redirect<ul>
<li>In <code>docker-compose.yml</code>, comment out the active certbot command, which installs the certificate, and uncomment the line below, which sets up automatically renewals.</li>
<li>In <code>nginx/default.conf</code>, uncomment lines 18 through 50 to enable forwarding to HTTPS. You should have two <code>server</code> blocks enabled</li>
</ul>
</li>
<li>Set up a <code>cron</code> job to keep your certificates up to date (Lets Encrypt certificates expire after 90 days)<ul>
<li>Type <code>crontab -e</code> to edit your cron file in the host machine</li>
<li>add a line to try renewing once a day: <code>5 0 * * * cd /path/to/your/bookwyrm &amp;&amp; docker-compose run --rm certbot</code></li>
</ul>
</li>
<li>If you wish to use an external storage for static assets and media files (such as an S3-compatible service), <a href="/external-storage.html">follow the instructions</a> until it tells you to come back here</li>
<li>Initialize the application with <code>./bw-dev setup</code>, and copy the admin code to use when you create your admin account.<ul>
<li>The output of <code>./bw-dev setup</code> should conclude with your admin code. You can get your code at any time by running <code>./bw-dev admin_code</code> from the command line. Here's an example output:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>*******************************************
Use<span class="w"> </span>this<span class="w"> </span>code<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>your<span class="w"> </span>admin<span class="w"> </span>account:
c6c35779-af3a-4091-b330-c026610920d6
*******************************************
</code></pre></div>

<ul>
<li>Run docker-compose in the background with: <code>docker-compose up -d</code></li>
<li>The application should be running at your domain. When you load the domain, you should get a configuration page which confirms your instance settings, and a form to create an admin account. Use your admin code to register.</li>
</ul>
<p>Congrats! You did it!! Configure your instance however you'd like.</p>
<h2 id="backups"><a class="headerlink" href="#backups">Backups</a></h2>
<p>BookWyrm's db service dumps a backup copy of its database to its <code>/backups</code> directory daily at midnight UTC. Backups are named <code>backup__%Y-%m-%d.sql</code>.</p>
<p>The db service has an optional script for periodically pruning the backups directory so that all recent daily backups are kept, but for older backups, only weekly or monthly backups are kept. To enable this script:</p>
<ul>
<li>Uncomment the final line in <code>postgres-docker/cronfile</code></li>
<li>rebuild your instance <code>docker-compose up --build</code></li>
</ul>
<p>You can copy backups from the backups volume to your host machine with <code>docker cp</code>:</p>
<ul>
<li>Run <code>docker-compose ps</code> to confirm the db service's full name (it's probably <code>bookwyrm_db_1</code>.</li>
<li>Run <code>docker cp &lt;container_name&gt;:/backups &lt;host machine path&gt;</code></li>
</ul>
<h2 id="port-conflicts"><a class="headerlink" href="#port-conflicts">Port Conflicts</a></h2>
<p>BookWyrm has multiple services that run on their default ports. This means that, depending on what else you are running on your host machine, you may run into errors when building or running BookWyrm when attempts to bind to those ports fail.</p>
<p>If this occurs, you will need to change your configuration to run services on different ports. This may require one or more changes the following files:</p>
<ul>
<li><code>docker-compose.yml</code></li>
<li><code>nginx/default.conf</code></li>
<li><code>.env</code> (You create this file yourself during setup)</li>
</ul>
<p>If you are already running a web-server on your machine, you will need to set up a reverse-proxy.</p>
<h2 id="get-connected"><a class="headerlink" href="#get-connected">Get Connected</a></h2>
<p>Because BookWyrm is a young project, we're still working towards a stable release schedule, and there are a lot of bugs and breaking changes. There is a GitHub team which can be tagged when there's something important to know about an update, which you can join by sharing your GitHub username. There are a few ways in get in touch:</p>
<ul>
<li>Open an issue or pull request to add your instance to the <a href="https://github.com/bookwyrm-social/documentation/blob/main/content/using_bookwyrm/instances.md">official list</a></li>
<li>Reach out to the project on <a href="https://tech.lgbt/@bookwyrm">Mastodon</a> or <a href="mailto:mousereeve@riseup.net">email the maintainer</a> directly with your GitHub username</li>
<li>Join the <a href="https://matrix.to/#/#bookwyrm:matrix.org">Matrix</a> chat room</li>
</ul>
</section>

            </section>
        </div>
    </div>
</div>

<footer id="contentinfo" class="footer">
    <div class="container is-max-desktop">
        <div class="columns">
            <div class="column content">
                <p>
                    <strong>BookWyrm</strong> é um software colaborativo e anti-corporativo mantido por <a href='https://www.mousereeve.com/'>Mouse Reeve</a>.
                </p>
                <p>
                    Apoie a BookWyrm no <a href='https://www.patreon.com/bookwyrm' target='_blank'>Patreon</a>.
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Participe</h3>
                <p>
                    <a href="https://github.com/bookwyrm-social">BookWyrm no GitHub</a>
                </p>
                <p>
                    <a href="https://github.com/bookwyrm-social/documentation/blob/main/content/running_bookwyrm/install-prod.md">Contribua para esta página</a>
                </p>
                <p>
                    <a href="https://twitter.com/BookWyrmSocial" target="_blank">
                        <span class="icon icon-twitter"><span class="is-sr-only">Twitter</span></span>
                    </a>
                    <a href="https://tech.lgbt/@bookwyrm" target="_blank" rel="me">
                        <span class="icon icon-mastodon"><span class="is-sr-only">Mastodon</span></span>
                    </a>
                    <a href="https://www.patreon.com/bookwyrm" target="_blank">
                        <span class="icon icon-patreon"><span class="is-sr-only">Patreon</span></span>
                    </a>
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Saiba mais</h3>
                <p>
                    <a href="https://docs.joinbookwyrm.com">Documentação</a>
                </p>
                <p>
                    <a href="mailto:mousereeve@riseup.net">Falar com a administração</a>
                </p>
                <p>
                    <a href="https://raw.githubusercontent.com/bookwyrm-social/join-bookwyrm/main/LICENSE.md">Licença</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<script>
    var current_locale = "pt-br/";
</script>
<script src="/static/js/bookwyrm.js"></script>
</body>
</html>