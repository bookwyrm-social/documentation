<!DOCTYPE html>
<html lang="en">
<head>
    <title>
        
Command Line Tool

    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="/static/css/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bulma.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bookwyrm.css?v076">

    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bookwyrm Documentation">
    <meta name="og:title" content="Bookwyrm Documentation">
    <meta name="twitter:description" content="Documentation for using and contributing to BookWyrm">
    <meta name="og:description" content="Documentation for using and contributing to BookWyrm">

    <meta name="twitter:image" content="">
    <meta name="og:image" content="">
    <meta name="twitter:image:alt" content="BookWyrm Logo">

    <meta charset="UTF-8">
</head>
<body>
<nav class="navbar container is-max-desktop" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://joinbookwyrm.com/">
            <img class="image logo" src="/static/images/logo-small.png" alt="Go back to the homepage">
        </a>
        <a href="/" class="navbar-item has-text-link has-text-weight-bold">
            Documentation
        </a>
        <a role="button" class="navbar-burger" data-target="main-nav" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>

    <div class="navbar-menu" id="main-nav">
        <div class="navbar-start">
            <a href="https://joinbookwyrm.com/instances" class="navbar-item">
                Join
            </a>
            <a href="https://joinbookwyrm.com/get-involved" class="navbar-item">
                Get involved
            </a>
            <a href="https://www.patreon.com/bookwyrm" class="navbar-item">
                Support
            </a>
            <a href="https://github.com/bookwyrm-social/bookwyrm" class="navbar-item">
                Code
            </a>
        </div>
    </div>
</nav>

<div class="message is-danger">
    <div class="message-body has-text-centered">
        This is the documentation for the current development code. Choose a version from the menu to see documentation for released versions since <strong>v0.7.5</strong>.
    </div>
</div>


<div class="columns">
    <nav class="menu column is-one-quarter is-hidden-touch pl-6" id="menu">
        <h2 class="menu-label">Language & Version</a></h2>
        <div class="select">
            <select aria-label="Select a language" id="language_selection">
                
                <option value="" selected>English (US)</option>
                
                <option value="de/" >Deutsch</option>
                
                <option value="fr/" >Français</option>
                
                <option value="pl/" >Polski</option>
                
                <option value="pt-br/" >Português do Brasil</option>
                
                <option value="ro/" >Română</option>
                
          </select>
        </div>
        <div class="select">
            <select aria-label="Previous versions" id="version_selection">
                
                <option value="development" >development</option>
                
                <option value="v0.7.5" >v0.7.5</option>
                
                <option value="0.8.0" >0.8.0</option>
                
            </select>
        </div>
        
        <h2 class="menu-label">Using BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/main-menu.html" class="has-background-inherit" >Main Menu & Timelines</a>
            </li>
            
            <li>
                <a href="/shelves.html" class="has-background-inherit" >Shelves & Reading Status</a>
            </li>
            
            <li>
                <a href="/adding-books.html" class="has-background-inherit" >Adding Books</a>
            </li>
            
            <li>
                <a href="/settings.html" class="has-background-inherit" >Settings and Profile</a>
            </li>
            
            <li>
                <a href="/posting-statuses.html" class="has-background-inherit" >Posting Statuses</a>
            </li>
            
            <li>
                <a href="/lists.html" class="has-background-inherit" >Lists</a>
            </li>
            
            <li>
                <a href="/privacy-controls.html" class="has-background-inherit" >Privacy Controls</a>
            </li>
            
            <li>
                <a href="/groups.html" class="has-background-inherit" >Groups</a>
            </li>
            
            <li>
                <a href="/rss-feeds.html" class="has-background-inherit" >RSS Feeds</a>
            </li>
            
            <li>
                <a href="/user-migration.html" class="has-background-inherit" >User Migration and Aliases</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Running BookWyrm</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/install-prod.html" class="has-background-inherit" >Installing in Production</a>
            </li>
            
            <li>
                <a href="/install-prod-dockerless.html" class="has-background-inherit" >Installing Without Docker</a>
            </li>
            
            <li>
                <a href="/updating.html" class="has-background-inherit" >Updating Your Instance</a>
            </li>
            
            <li>
                <a href="/updating-dockerless.html" class="has-background-inherit" >Updating Without Docker</a>
            </li>
            
            <li>
                <a href="/reverse-proxy.html" class="has-background-inherit" >Using a Reverse-Proxy</a>
            </li>
            
            <li>
                <a href="/moderation.html" class="has-background-inherit" >Moderation</a>
            </li>
            
            <li>
                <a href="/monitoring-queue.html" class="has-background-inherit" >Monitoring Queue</a>
            </li>
            
            <li>
                <a href="/external-storage.html" class="has-background-inherit" >External Storage</a>
            </li>
            
            <li>
                <a href="/optional_features.html" class="has-background-inherit" >Optional Features</a>
            </li>
            
            <li>
                <a href="/management-commands.html" class="has-background-inherit" >Management Commands</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Contributing</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/contributing.html" class="has-background-inherit" >How to Contribute</a>
            </li>
            
            <li>
                <a href="/translation.html" class="has-background-inherit" >Translations</a>
            </li>
            
            <li>
                <a href="/style_guide.html" class="has-background-inherit" >Style Guide</a>
            </li>
            
            <li>
                <a href="/documentation.html" class="has-background-inherit" >Documentation</a>
            </li>
            
            <li>
                <a href="/install-dev.html" class="has-background-inherit" >Developer Environment</a>
            </li>
            
            <li>
                <a href="/debug_toolbar.html" class="has-background-inherit" >Django Debug Toolbar</a>
            </li>
            
            <li>
                <a href="/codereview.html" class="has-background-inherit" >Code Review</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Codebase</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/activitypub.html" class="has-background-inherit" >ActivityPub</a>
            </li>
            
            <li>
                <a href="/permissions.html" class="has-background-inherit" >Permissions</a>
            </li>
            
        </ul>
        
        <h2 class="menu-label">Reference Guides</h2>
        <ul class="menu-list has-background-inherit">
            
            <li>
                <a href="/environment.html" class="has-background-inherit" >Environment Variables</a>
            </li>
            
            <li>
                <a href="/cli.html" class="has-background-inherit" class="is-active">Command Line Tool</a>
            </li>
            
        </ul>
        
    </nav>

    <div class="column pt-0">
        

<nav class="navbar is-dark" role="table-of-contents-navigation" aria-label="dropdown navigation">
    <div class="navbar-start">
        <div class="navbar-item has-dropdown" id="toc" data-target="toc-dropdown">
            <a class="navbar-link">
              Page Contents
            </a>

            <div class="navbar-dropdown is-hidden-touch " id="toc-dropdown">
              
                  <a class="navbar-item" href="#docker-shortcuts">Docker shortcuts</a>
                  
                      
                      <a class="navbar-item" href="#bash"><span class="pl-4">bash</span></a>
                      
                      <a class="navbar-item" href="#build"><span class="pl-4">build</span></a>
                      
                      <a class="navbar-item" href="#dbshell"><span class="pl-4">dbshell</span></a>
                      
                      <a class="navbar-item" href="#runweb-args"><span class="pl-4">runweb args</span></a>
                      
                      <a class="navbar-item" href="#service_ports_web-args"><span class="pl-4">service_ports_web args</span></a>
                      
                      <a class="navbar-item" href="#shell"><span class="pl-4">shell</span></a>
                      
                      <a class="navbar-item" href="#up-args"><span class="pl-4">up [args]</span></a>
                      
                  
              
                  <a class="navbar-item" href="#managing-the-database">Managing the database</a>
                  
                      
                      <a class="navbar-item" href="#initdb"><span class="pl-4">initdb</span></a>
                      
                      <a class="navbar-item" href="#makemigrations-appname-migration-number"><span class="pl-4">makemigrations [appname migration number]</span></a>
                      
                      <a class="navbar-item" href="#migrate"><span class="pl-4">migrate</span></a>
                      
                      <a class="navbar-item" href="#resetdb"><span class="pl-4">resetdb</span></a>
                      
                  
              
                  <a class="navbar-item" href="#managing-a-bookwyrm-instance">Managing a Bookwyrm instance</a>
                  
                      
                      <a class="navbar-item" href="#compile_themes"><span class="pl-4">compile_themes</span></a>
                      
                      <a class="navbar-item" href="#collectstatic"><span class="pl-4">collectstatic</span></a>
                      
                      <a class="navbar-item" href="#generate_preview_images"><span class="pl-4">generate_preview_images</span></a>
                      
                      <a class="navbar-item" href="#remove_remote_user_preview_images"><span class="pl-4">remove_remote_user_preview_images</span></a>
                      
                      <a class="navbar-item" href="#generate_thumbnails"><span class="pl-4">generate_thumbnails</span></a>
                      
                      <a class="navbar-item" href="#populate_streams-args"><span class="pl-4">populate_streams args</span></a>
                      
                      <a class="navbar-item" href="#populate_list_streams"><span class="pl-4">populate_list_streams</span></a>
                      
                      <a class="navbar-item" href="#populate_suggestions"><span class="pl-4">populate_suggestions</span></a>
                      
                      <a class="navbar-item" href="#restart_celery"><span class="pl-4">restart_celery</span></a>
                      
                      <a class="navbar-item" href="#update"><span class="pl-4">update</span></a>
                      
                      <a class="navbar-item" href="#admin_code"><span class="pl-4">admin_code</span></a>
                      
                  
              
                  <a class="navbar-item" href="#setting-up-s3-compatible-storage">Setting up S3 compatible storage</a>
                  
                      
                      <a class="navbar-item" href="#copy_media_to_s3"><span class="pl-4">copy_media_to_s3</span></a>
                      
                      <a class="navbar-item" href="#sync_media_to_s3"><span class="pl-4">sync_media_to_s3</span></a>
                      
                      <a class="navbar-item" href="#set_cors_to_s3-filename"><span class="pl-4">set_cors_to_s3 filename</span></a>
                      
                  
              
                  <a class="navbar-item" href="#development-and-testing">Development and testing</a>
                  
                      
                      <a class="navbar-item" href="#black"><span class="pl-4">black</span></a>
                      
                      <a class="navbar-item" href="#prettier"><span class="pl-4">prettier</span></a>
                      
                      <a class="navbar-item" href="#stylelint"><span class="pl-4">stylelint</span></a>
                      
                      <a class="navbar-item" href="#formatters"><span class="pl-4">formatters</span></a>
                      
                      <a class="navbar-item" href="#clean"><span class="pl-4">clean</span></a>
                      
                      <a class="navbar-item" href="#makemessages"><span class="pl-4">makemessages</span></a>
                      
                      <a class="navbar-item" href="#compilemessages"><span class="pl-4">compilemessages</span></a>
                      
                      <a class="navbar-item" href="#pytest-args"><span class="pl-4">pytest args</span></a>
                      
                      <a class="navbar-item" href="#remove_2fa"><span class="pl-4">remove_2fa</span></a>
                      
                      <a class="navbar-item" href="#confirm_email"><span class="pl-4">confirm_email</span></a>
                      
                  
              
            </div>
          </div>
    </div>
  </nav>


        <div class="container is-max-desktop">
            <section class="section">
                <header class="content block column is-offset-one-quarter pl-2">
                    
<h1 class="title is-1">Command Line Tool</h1>

                </header>
                
<section class="block content">
    <p>Bookwyrm developers and instance managers can use the <code>bw-dev</code> script for common tasks. This can make your commands shorter, easier to remember, and harder to mess up.</p>
<p>Once you have installed Bookwyrm <a href="installing-in-production.html">in production</a> or <a href="https://docs.joinbookwyrm.com/developer-environment.html#setting_up_the_developer_environment">in development</a>, you can run the script from the command line with <code>./bw-dev</code> followed by the subcommand you want to run.</p>
<h2 id="docker-shortcuts"><a class="headerlink" href="#docker-shortcuts">Docker shortcuts</a></h2>
<h3 id="bash"><a class="headerlink" href="#bash">bash</a></h3>
<p>Open an interactive <code>bash</code> session inside the docker <code>web</code> container.</p>
<h3 id="build"><a class="headerlink" href="#build">build</a></h3>
<p>Equivalent to <code>docker-compose build</code>.</p>
<h3 id="dbshell"><a class="headerlink" href="#dbshell">dbshell</a></h3>
<p>Open an interactive Postgres database shell. I hope you know what you're doing.</p>
<h3 id="runweb-args"><a class="headerlink" href="#runweb-args">runweb args</a></h3>
<p>Run an arbitrary command (represented above by <code>args</code>) in the <code>web</code> container.</p>
<p>Equivalent to <code>docker-compose run --rm web</code>.</p>
<h3 id="service_ports_web-args"><a class="headerlink" href="#service_ports_web-args">service_ports_web args</a></h3>
<p>Run an arbitrary command in the <code>web</code> container (represented above by <code>args</code>) with ports exposed. This is useful if you want to run <code>pdb</code> tests because <code>runweb</code> will not expose the <code>pdb</code> prompt.</p>
<p>Equivalent to <code>docker-compose run --rm --service-ports web</code>.</p>
<h3 id="shell"><a class="headerlink" href="#shell">shell</a></h3>
<p>Open an interactive Django shell inside the docker <code>web</code> container. You would use this if you want to run Django shell commands directly.</p>
<h3 id="up-args"><a class="headerlink" href="#up-args">up [args]</a></h3>
<p>Start or restart Docker containers, optionally including any arguments (represented above by <code>args</code>). Equivalent to <code>docker-compose up [args]</code></p>
<h2 id="managing-the-database"><a class="headerlink" href="#managing-the-database">Managing the database</a></h2>
<h3 id="initdb"><a class="headerlink" href="#initdb">initdb</a></h3>
<p>Initialize a database.</p>
<h3 id="makemigrations-appname-migration-number"><a class="headerlink" href="#makemigrations-appname-migration-number">makemigrations [appname migration number]</a></h3>
<p><em>This command is not available on the <code>production</code> branch</em>.</p>
<p>Runs Django's <code>makemigrations</code> command inside your Docker container. If you have changed the database structure in a development branch you will need to run this for your changes to have effect. Optionally, you can specify a specific migration to run, e.g. <code>./bw-dev makemigrations bookwyrm 0108</code></p>
<h3 id="migrate"><a class="headerlink" href="#migrate">migrate</a></h3>
<p>Runs Django's <code>migrate</code> command inside your Docker container. You always need to run this after <code>makemigrations</code>.</p>
<h3 id="resetdb"><a class="headerlink" href="#resetdb">resetdb</a></h3>
<p><em>This command is not available on the <code>production</code> branch</em>.</p>
<p>Resets the database. <strong>This command will delete your entire Bookwyrm database</strong>, and then initiate a fresh database and run all migrations. You should delete any recent migration files you do not want to run, <em>before</em> running <code>resetdb</code>.</p>
<h2 id="managing-a-bookwyrm-instance"><a class="headerlink" href="#managing-a-bookwyrm-instance">Managing a Bookwyrm instance</a></h2>
<h3 id="compile_themes"><a class="headerlink" href="#compile_themes">compile_themes</a></h3>
<p>Compiles all BookWyrm themes, which are <code>*.scss</code> files listed in <code>bookwyrm/static/css/themes</code>.</p>
<h3 id="collectstatic"><a class="headerlink" href="#collectstatic">collectstatic</a></h3>
<p>Migrate static assets to either a Docker container or to an S3-compatible "bucket", depending on the context.</p>
<h3 id="generate_preview_images"><a class="headerlink" href="#generate_preview_images">generate_preview_images</a></h3>
<p>Generate preview images for site, users, and books. This can take a while if you have a large database. See <a href="/optional_features.html">Optional Features: Generating preview images</a></p>
<h3 id="remove_remote_user_preview_images"><a class="headerlink" href="#remove_remote_user_preview_images">remove_remote_user_preview_images</a></h3>
<p>Remove generated preview images for remote users. See <a href="/optional_features.html">Optional Features: Removing preview images for remote users</a></p>
<h3 id="generate_thumbnails"><a class="headerlink" href="#generate_thumbnails">generate_thumbnails</a></h3>
<p>Generates thumbnail images for book covers.</p>
<h3 id="populate_streams-args"><a class="headerlink" href="#populate_streams-args">populate_streams args</a></h3>
<p>Re-populates Redis streams (user feeds). You will not usually need to run this unless there is an error that wipes out your user feeds for some reason. You can specify which stream using the <code>--stream</code> argument.</p>
<h3 id="populate_list_streams"><a class="headerlink" href="#populate_list_streams">populate_list_streams</a></h3>
<p>Re-populates Redis cache of lists. You will not usually need to run this unless there is an error that wipes out your users' lists for some reason.</p>
<h3 id="populate_suggestions"><a class="headerlink" href="#populate_suggestions">populate_suggestions</a></h3>
<p>Populate suggested users for all users. You may want to run this manually to refresh suggestions.</p>
<h3 id="restart_celery"><a class="headerlink" href="#restart_celery">restart_celery</a></h3>
<p>Restarts the <code>celery_worker</code> Docker container.</p>
<h3 id="update"><a class="headerlink" href="#update">update</a></h3>
<p>When there are changes to the <code>production</code> branch, you can update your instance without downtime.</p>
<p>This command <code>git pull</code>s the latest <code>production</code> branch updates, builds docker images if necessary, runs Django migrations, updates static files, and restarts all Docker containers.</p>
<h3 id="admin_code"><a class="headerlink" href="#admin_code">admin_code</a></h3>
<p>Gets the secret admin code used to register the inital admin user on a new BookWyrm instance.</p>
<h2 id="setting-up-s3-compatible-storage"><a class="headerlink" href="#setting-up-s3-compatible-storage">Setting up S3 compatible storage</a></h2>
<p>By default, BookWyrm uses local storage for static assets (favicon, default avatar, etc.), and media (user avatars, book covers, etc.), but you can use an external storage service to serve these files. BookWyrm uses django-storages to handle external storage, such as S3-compatible services, Apache Libcloud or SFTP.</p>
<p>See <a href="/external-storage.html">External Storage</a> for more information.</p>
<h3 id="copy_media_to_s3"><a class="headerlink" href="#copy_media_to_s3">copy_media_to_s3</a></h3>
<p>Migrate all uploaded media from an existing BookWyrm installation to an S3-compatible "bucket". Use for initial upload to an empty bucket.</p>
<h3 id="sync_media_to_s3"><a class="headerlink" href="#sync_media_to_s3">sync_media_to_s3</a></h3>
<p>Sync new or changed uploaded media from an existing BookWyrm installation to an S3-compatible "bucket". Use to ensure all local files are uploaded to an existing bucket.</p>
<h3 id="set_cors_to_s3-filename"><a class="headerlink" href="#set_cors_to_s3-filename">set_cors_to_s3 filename</a></h3>
<p>Copy a CORS rules JSON file to your S3 bucket, where <code>filename</code> is the name of your JSON file (e.g. <code>./bw-dev set_cors_to_s3 cors.json</code>)</p>
<h2 id="development-and-testing"><a class="headerlink" href="#development-and-testing">Development and testing</a></h2>
<p><em>These commands are not available on the <code>production</code> branch</em>.</p>
<h3 id="black"><a class="headerlink" href="#black">black</a></h3>
<p>BookWyrm uses the <a href="https://github.com/psf/black">Black</a> code formatter to keep the Python codebase consistent styled. Run <code>black</code> before committing your changes so the <code>pylint</code> task does not fail for your pull request and make you sad.</p>
<h3 id="prettier"><a class="headerlink" href="#prettier">prettier</a></h3>
<p>BookWyrm uses <a href="https://prettier.io/">Prettier</a> to keep the JavaScript codebase consistently styled. Run <code>prettier</code> before committing changes to scripts to automatically format your code.</p>
<h3 id="stylelint"><a class="headerlink" href="#stylelint">stylelint</a></h3>
<p>BookWyrm uses <a href="uhttps://stylelint.io/">Stylelint</a> to keep the CSS files consistently styled. Run <code>stylelint</code> before committing changes to scripts to automatically format your code.</p>
<h3 id="formatters"><a class="headerlink" href="#formatters">formatters</a></h3>
<p>This command runs all code formatters (<code>black</code>, <code>prettier</code>, and <code>stylelint</code>) in one go.</p>
<h3 id="clean"><a class="headerlink" href="#clean">clean</a></h3>
<p>Remove all stopped Docker containers.</p>
<p>Equivalent to:</p>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>stop
docker-compose<span class="w"> </span>rm<span class="w"> </span>-f
</code></pre></div>

<h3 id="makemessages"><a class="headerlink" href="#makemessages">makemessages</a></h3>
<p>Creates message files for all translation strings. After you have run <code>makemessages</code> you need to run <code>compilemessages</code> to compile the translations. See <a href="https://docs.djangoproject.com/en/3.2/ref/django-admin/#makemessages">Django's makemessages</a>.</p>
<h3 id="compilemessages"><a class="headerlink" href="#compilemessages">compilemessages</a></h3>
<p>Compiles translation files. See <a href="https://docs.djangoproject.com/en/3.2/ref/django-admin/#compilemessages">Django's compilemessages</a>.</p>
<h3 id="pytest-args"><a class="headerlink" href="#pytest-args">pytest args</a></h3>
<p>Run tests with <code>pytest</code>.</p>
<h3 id="remove_2fa"><a class="headerlink" href="#remove_2fa">remove_2fa</a></h3>
<p>Deactivates two factor authentication for a given user.</p>
<h3 id="confirm_email"><a class="headerlink" href="#confirm_email">confirm_email</a></h3>
<p>Confirms a users email, sets the user to active.</p>
</section>

            </section>
        </div>
    </div>
</div>

<footer id="contentinfo" class="footer">
    <div class="container is-max-desktop">
        <div class="columns">
            <div class="column content">
                <p>
                    <strong>BookWyrm</strong> is collaborative, anti-corporate software maintained by <a href='https://www.mousereeve.com/'>Mouse Reeve</a>.
                </p>
                <p>
                    Support BookWyrm on <a href='https://www.patreon.com/bookwyrm' target='_blank'>Patreon</a>.
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Get Involved</h3>
                <p>
                    <a href="https://github.com/bookwyrm-social">BookWyrm on GitHub</a>
                </p>
                <p>
                    <a href="https://github.com/bookwyrm-social/documentation/blob/main/content/reference/cli.md">Contribute to this page</a>
                </p>
                <p>
                    <a href="https://twitter.com/BookWyrmSocial" target="_blank">
                        <span class="icon icon-twitter"><span class="is-sr-only">Twitter</span></span>
                    </a>
                    <a href="https://tech.lgbt/@bookwyrm" target="_blank" rel="me">
                        <span class="icon icon-mastodon"><span class="is-sr-only">Mastodon</span></span>
                    </a>
                    <a href="https://www.patreon.com/bookwyrm" target="_blank">
                        <span class="icon icon-patreon"><span class="is-sr-only">Patreon</span></span>
                    </a>
                </p>
            </div>
            <div class="column">
                <h3 class="title is-6">Learn more</h3>
                <p>
                    <a href="https://docs.joinbookwyrm.com">Documentation</a>
                </p>
                <p>
                    <a href="mailto:mousereeve@riseup.net">Contact maintainer</a>
                </p>
                <p>
                    <a href="https://raw.githubusercontent.com/bookwyrm-social/join-bookwyrm/main/LICENSE.md">License</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<script>
    var current_locale = "";
    var current_version = "";
</script>
<script src="/static/js/bookwyrm.js"></script>
</body>
</html>